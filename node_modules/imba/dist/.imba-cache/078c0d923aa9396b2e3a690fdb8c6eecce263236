{"js":{"code":"function defineName$__(cls,name){\n\tObject.defineProperty(cls,\"name\",{value:name,configurable:true});\n};;\nfunction inheritClass$__(cls){\n\tObject.getPrototypeOf(cls.prototype).constructor?.inherited?.(cls);\n};\nimport {accessor as imba_accessor} from 'imba';\nvar $1 = Symbol('name'), $2 = Symbol(), $3 = Symbol('number'), $4 = Symbol(), $5 = Symbol(), $6 = Symbol('hub'), $7 = Symbol(), $8 = Symbol('name'), $9 = Symbol(), $10 = Symbol('number'), $11 = Symbol(), $12 = Symbol(), $14, $15, $17, $18, $19;\nconst $__init__$ = Symbol.for('#__init__'), $__patch__$ = Symbol.for('#__patch__'), $__initor__$ = Symbol.for('#__initor__'), $__inited__$ = Symbol.for('#__inited__'), $__hooks__$ = Symbol.for('#__hooks__');\n\n/*body*/\nimport setup from '../setup';\n\nclass Hub extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $13;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($13 = $$.name) !== undefined && this.ααname.$init($13,this,$1,'name',$$);\n\t\tfields && ($13 = $$.number) !== undefined && this.ααnumber.$init($13,this,$3,'number',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$5 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααname.$init($$ ? $$.name : undefined,this,$1,'name',$$);\n\t\tfields && this.ααnumber.$init($$ ? $$.number : undefined,this,$3,'number',$$);\n\t\t\n\t}\n\tset name(val){ this.ααname.$set(val,this,$1,'name') }\n\tget name(){ return this.ααname.$get(this,$1,'name') }\n\tget ααname(){ return this[$2] || imba_accessor(($14 = this.αstring(),$14),this,$1,'name',$2,Hub.prototype) }\n\tset number(val){ this.ααnumber.$set(val,this,$3,'number') }\n\tget number(){ return this.ααnumber.$get(this,$3,'number') }\n\tget ααnumber(){ return this[$4] || imba_accessor(($15 = this.αint(),$15),this,$3,'number',$4,Hub.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $5;defineName$__(this,'Hub');inheritClass$__(this);}\n};\n\nclass Item extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $16;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($16 = $$.hub) !== undefined && this.ααhub.$init($16,this,$6,'hub',$$);\n\t\tfields && ($16 = $$.name) !== undefined && this.ααname.$init($16,this,$8,'name',$$);\n\t\tfields && ($16 = $$.number) !== undefined && this.ααnumber.$init($16,this,$10,'number',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$12 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααhub.$init($$ ? $$.hub : undefined,this,$6,'hub',$$);\n\t\tfields && this.ααname.$init($$ ? $$.name : undefined,this,$8,'name',$$);\n\t\tfields && this.ααnumber.$init($$ ? $$.number : undefined,this,$10,'number',$$);\n\t\t\n\t}\n\tset hub(val){ this.ααhub.$set(val,this,$6,'hub') }\n\tget hub(){ return this.ααhub.$get(this,$6,'hub') }\n\tget ααhub(){ return this[$7] || imba_accessor(($17 = this.αref(Hub),$17),this,$6,'hub',$7,Item.prototype) }\n\tset name(val){ this.ααname.$set(val,this,$8,'name') }\n\tget name(){ return this.ααname.$get(this,$8,'name') }\n\tget ααname(){ return this[$9] || imba_accessor(($18 = this.αstring(),$18),this,$8,'name',$9,Item.prototype) }\n\tset number(val){ this.ααnumber.$set(val,this,$10,'number') }\n\tget number(){ return this.ααnumber.$get(this,$10,'number') }\n\tget ααnumber(){ return this[$11] || imba_accessor(($19 = this.αint(),$19),this,$10,'number',$11,Item.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $12;defineName$__(this,'Item');inheritClass$__(this);}\n};\n\nawait setup(__filename,{data: {\n\thub01: {number: 1}\n}});\n\ntest(\"lookup\",function() {\n\t\n\tlet hub = OP.get('hub01');\n\treturn ok(!(hub.resolvedΦ));\n});\n\ntest.node(\"force\",async function() {\n\t\n\tlet item = await Item.create({name: 'one'});\n\tok(item.resolvedΦ);\n\t\n\tlet object = {name: 'two'};\n\t// Can use setraw or OP.db.update instead\n\t\n\tawait OP.sql`update ${Item} set ${object} where id = ${item.id}`;\n\tok(item.name,'one');\n\t\n\tawait item.resolve();\n\tok(item.name,'one');\n\t\n\tawait item.resolve(true);\n\treturn ok(item.name,'two');\n});\n\ntest.todo(\"resolve() can resolve from outside if patched\");\n\ntest.todo(\"resolving multiple items will batch db queries\");\n","dependencies":[],"map":{"version":3,"file":"resolving.test.js","sourceRoot":"","sources":["/Users/sindre/repos/scrimba/op/test/misc/resolving.test.imba"],"sourcesContent":["import setup from '../setup'\n\nclass Hub < OP.Object\n\tname @string\n\tnumber @int\n\nclass Item < OP.Object\n\thub @ref(Hub)\n\tname @string\n\tnumber @int\n\nawait setup(__filename, data: {\n\thub01: {number: 1}\n})\n\ntest \"lookup\" do\n\tlet hub = OP.get('hub01')\n\tok !hub.resolved?\n\ntest.node \"force\" do\n\tlet item = await Item.create { name: 'one' }\n\tok item.resolved?\n\n\tlet object = { name: 'two' }\n\t# Can use setraw or OP.db.update instead\n\n\tawait OP.sql`update {Item} set {object} where id = {item.id}`\n\tok item.name, 'one'\n\n\tawait item.resolve!\n\tok item.name, 'one'\n\n\tawait item.resolve(yes)\n\tok item.name, 'two'\n\ntest.todo \"resolve() can resolve from outside if patched\"\n\ntest.todo \"resolving multiple items will batch db queries\"\n"],"names":[],"mappings":";;;;;;;;;;;AAAA,MAAM,CAAC,KAAK,MAAM,UAAU;;AAE5B,KAAK,CAAC,GAAG,SAAG,EAAE,CAAC,MAAM,EAAA;qCAFrB;;;sBAGC,IAAI,CAAA;sBACJ,MAAM,CAAA;;EAJP;cAAA;;;EAAA;kDAAA;;sCAGC,IAAI;wCACJ,MAAM;;EAJP;KAGC,IAAI;KAAJ,IAAI;KAAJ,MAAI,iDAAC,OAAO,EAAA,wBADP,GAAG;KAER,MAAM;KAAN,MAAM;KAAN,QAAM,iDAAC,IAAI,EAAA,0BAFN,GAAG;;;AAEG,CAAA;;AAEZ,KAAK,CAAC,IAAI,SAAG,EAAE,CAAC,MAAM,EAAA;qCANtB;;;sBAOC,GAAG,CAAA;sBACH,IAAI,CAAA;sBACJ,MAAM,CAAA;;EATP;cAAA;;;EAAA;kDAAA;;qCAOC,GAAG;sCACH,IAAI;wCACJ,MAAM;;EATP;KAOC,GAAG;KAAH,GAAG;KAAH,KAAG,iDAAC,IAAI,CAAC,GAAG,CAAC,uBADR,IAAI;KAET,IAAI;KAAJ,IAAI;KAAJ,MAAI,iDAAC,OAAO,EAAA,wBAFP,IAAI;KAGT,MAAM;KAAN,MAAM;KAAN,QAAM,kDAAC,IAAI,EAAA,4BAHN,IAAI;;;AAGE,CAAA;;MAEN,KAAK,CAAC,UAAU,EAAE,IAAI,EAAE;CAC7B,KAAK,EAAE,CAAC,MAAM,EAAE,CAAC,CAAC;CAClB,EAAC;;AAEF,IAAI,CAAC,QAAQ,CAAC,QAAE,GAAA;;KACX,GAAG,GAAG,EAAE,CAAC,GAAG,CAAC,OAAO,CAAC;CACzB,OAAA,EAAE,CAAC,EAAC,GAAG,CAAC,SAAS,CAAA,CAAA;CAAA,CAFd;;AAIJ,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,cAAE,GAAA;;KACf,IAAI,SAAS,IAAI,CAAC,MAAM,CAAC,CAAE,IAAI,EAAE,KAAK,CAAE,CAAA;CAC5C,EAAE,CAAC,IAAI,CAAC,SAAS,CAAA;;KAEb,MAAM,GAAG,CAAE,IAAI,EAAE,KAAK,CAAE;;;OAGtB,EAAE,CAAC,GAAG,UAAS,IAAI,QAAO,MAAM,eAAc,IAAI,CAAC,EAAE,EAAE;CAC7D,EAAE,CAAC,IAAI,CAAC,IAAI,CAAE,KAAK,CAAA;;OAEb,IAAI,CAAC,OAAO,EAAC;CACnB,EAAE,CAAC,IAAI,CAAC,IAAI,CAAE,KAAK,CAAA;;OAEb,IAAI,CAAC,OAAO,CAAC,IAAG,CAAC;CACvB,OAAA,EAAE,CAAC,IAAI,CAAC,IAAI,CAAE,KAAK,CAAA;CAAA,CAdX;;AAgBT,IAAI,CAAC,IAAI,CAAC,+CAA+C,CAAA;;AAEzD,IAAI,CAAC,IAAI,CAAC,gDAAgD,CAAA;AAC1D;"}},"css":{"code":""},"warnings":[],"errors":[]}
{"js":{"code":"function defineName$__(cls,name){\n\tObject.defineProperty(cls,\"name\",{value:name,configurable:true});\n};;\nfunction inheritClass$__(cls){\n\tObject.getPrototypeOf(cls.prototype).constructor?.inherited?.(cls);\n};\nimport {accessor as imba_accessor} from 'imba';\nvar $1 = Symbol('id'), $2 = Symbol(), $3 = Symbol('creator'), $4 = Symbol(), $5 = Symbol('name'), $6 = Symbol(), $7 = Symbol('note'), $8 = Symbol(), $9 = Symbol('items'), $10 = Symbol(), $11 = Symbol('parents'), $12 = Symbol(), $13 = Symbol(), $14 = Symbol('todos'), $15 = Symbol(), $16 = Symbol('owners'), $17 = Symbol(), $18 = Symbol('name'), $19 = Symbol(), $20 = Symbol('seen'), $21 = Symbol(), $22 = Symbol('labels'), $23 = Symbol(), $24 = Symbol('watchers'), $25 = Symbol(), $27, $28, $29, $30, $31, $32, $34, $36, $37, $38, $39, $40;\nconst $__init__$ = Symbol.for('#__init__'), $__patch__$ = Symbol.for('#__patch__'), $__initor__$ = Symbol.for('#__initor__'), $__inited__$ = Symbol.for('#__inited__'), $__hooks__$ = Symbol.for('#__hooks__');\n\n/*body*/\nimport setup from './setup';\n\nexport class Item extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $26;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($26 = $$.id) !== undefined && this.ααid.$init($26,this,$1,'id',$$);\n\t\tfields && ($26 = $$.creator) !== undefined && this.ααcreator.$init($26,this,$3,'creator',$$);\n\t\tfields && ($26 = $$.name) !== undefined && this.ααname.$init($26,this,$5,'name',$$);\n\t\tfields && ($26 = $$.note) !== undefined && this.ααnote.$init($26,this,$7,'note',$$);\n\t\tfields && ($26 = $$.items) !== undefined && this.ααitems.$init($26,this,$9,'items',$$);\n\t\tfields && ($26 = $$.parents) !== undefined && this.ααparents.$init($26,this,$11,'parents',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$13 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααid.$init($$ ? $$.id : undefined,this,$1,'id',$$);\n\t\tfields && this.ααcreator.$init($$ ? $$.creator : undefined,this,$3,'creator',$$);\n\t\tfields && this.ααname.$init($$ ? $$.name : undefined,this,$5,'name',$$);\n\t\tfields && this.ααnote.$init($$ ? $$.note : undefined,this,$7,'note',$$);\n\t\tfields && this.ααitems.$init($$ ? $$.items : undefined,this,$9,'items',$$);\n\t\tfields && this.ααparents.$init($$ ? $$.parents : undefined,this,$11,'parents',$$);\n\t\t\n\t}\n\tset id(val){ this.ααid.$set(val,this,$1,'id') }\n\tget id(){ return this.ααid.$get(this,$1,'id') }\n\tget ααid(){ return this[$2] || imba_accessor(($27 = this.αkey(),$27),this,$1,'id',$2,Item.prototype) }\n\tset creator(val){ this.ααcreator.$set(val,this,$3,'creator') }\n\tget creator(){ return this.ααcreator.$get(this,$3,'creator') }\n\tget ααcreator(){ return this[$4] || imba_accessor(($28 = this.αref(OP.User),$28.default = function() {\n\t\treturn OP.user;\n\t},$28),this,$3,'creator',$4,Item.prototype) }\n\tset name(val){ this.ααname.$set(val,this,$5,'name') }\n\tget name(){ return this.ααname.$get(this,$5,'name') }\n\tget ααname(){ return this[$6] || imba_accessor(($29 = this.αstring(),$29),this,$5,'name',$6,Item.prototype) }\n\tset note(val){ this.ααnote.$set(val,this,$7,'note') }\n\tget note(){ return this.ααnote.$get(this,$7,'note') }\n\tget ααnote(){ return this[$8] || imba_accessor(($30 = this.αstring(),($30.pov instanceof Function) ? $30.pov() : ($30.pov = true),$30),this,$7,'note',$8,Item.prototype) }\n\tset items(val){ this.ααitems.$set(val,this,$9,'items') }\n\tget items(){ return this.ααitems.$get(this,$9,'items') }\n\tget ααitems(){ return this[$10] || imba_accessor(($31 = this.αchildren(Item),$31),this,$9,'items',$10,Item.prototype) }\n\tset parents(val){ this.ααparents.$set(val,this,$11,'parents') }\n\tget parents(){ return this.ααparents.$get(this,$11,'parents') }\n\tget ααparents(){ return this[$12] || imba_accessor(($32 = this.αparents(List),$32),this,$11,'parents',$12,Item.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $13;defineName$__(this,'Item');inheritClass$__(this);}\n};\n\nexport class List extends Item {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $33;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($33 = $$.todos) !== undefined && this.ααtodos.$init($33,this,$14,'todos',$$);\n\t\t\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααtodos.$init($$ ? $$.todos : undefined,this,$14,'todos',$$);\n\t\t\n\t}\n\tset todos(val){ this.ααtodos.$set(val,this,$14,'todos') }\n\tget todos(){ return this.ααtodos.$get(this,$14,'todos') }\n\tget ααtodos(){ return this[$15] || imba_accessor(($34 = this.αchildren(Todo),$34),this,$14,'todos',$15,List.prototype) }\n\tstatic {\n\t\tdefineName$__(this,'List');this.alias = 'l';\n\t\tinheritClass$__(this);}\n};\n\nexport class Todo extends Item {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $35;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($35 = $$.owners) !== undefined && this.ααowners.$init($35,this,$16,'owners',$$);\n\t\tfields && ($35 = $$.name) !== undefined && this.ααname.$init($35,this,$18,'name',$$);\n\t\tfields && ($35 = $$.seen) !== undefined && this.ααseen.$init($35,this,$20,'seen',$$);\n\t\tfields && ($35 = $$.labels) !== undefined && this.ααlabels.$init($35,this,$22,'labels',$$);\n\t\tfields && ($35 = $$.watchers) !== undefined && this.ααwatchers.$init($35,this,$24,'watchers',$$);\n\t\t\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααowners.$init($$ ? $$.owners : undefined,this,$16,'owners',$$);\n\t\tfields && this.ααname.$init($$ ? $$.name : undefined,this,$18,'name',$$);\n\t\tfields && this.ααseen.$init($$ ? $$.seen : undefined,this,$20,'seen',$$);\n\t\tfields && this.ααlabels.$init($$ ? $$.labels : undefined,this,$22,'labels',$$);\n\t\tfields && this.ααwatchers.$init($$ ? $$.watchers : undefined,this,$24,'watchers',$$);\n\t\t\n\t}\n\tset owners(val){ this.ααowners.$set(val,this,$16,'owners') }\n\tget owners(){ return this.ααowners.$get(this,$16,'owners') }\n\tget ααowners(){ return this[$17] || imba_accessor(($36 = this.αitems(OP.User),$36),this,$16,'owners',$17,Todo.prototype) }\n\tset name(val){ this.ααname.$set(val,this,$18,'name') }\n\tget name(){ return this.ααname.$get(this,$18,'name') }\n\tget ααname(){ return this[$19] || imba_accessor(($37 = this.αstring(),$37),this,$18,'name',$19,Todo.prototype) }\n\tset seen(val){ this.ααseen.$set(val,this,$20,'seen') }\n\tget seen(){ return this.ααseen.$get(this,$20,'seen') }\n\tget ααseen(){ return this[$21] || imba_accessor(($38 = this.αtoggle(),($38.pov instanceof Function) ? $38.pov() : ($38.pov = true),$38),this,$20,'seen',$21,Todo.prototype) }\n\tset labels(val){ this.ααlabels.$set(val,this,$22,'labels') }\n\tget labels(){ return this.ααlabels.$get(this,$22,'labels') }\n\tget ααlabels(){ return this[$23] || imba_accessor(($39 = this.αzset(String),$39),this,$22,'labels',$23,Todo.prototype) }\n\tset watchers(val){ this.ααwatchers.$set(val,this,$24,'watchers') }\n\tget watchers(){ return this.ααwatchers.$get(this,$24,'watchers') }\n\tget ααwatchers(){ return this[$25] || imba_accessor(($40 = this.αzset(OP.Client),$40),this,$24,'watchers',$25,Todo.prototype) }\n\tstatic {\n\t\tdefineName$__(this,'Todo');this.alias = 't';\n\t\tinheritClass$__(this);}\n};\n\nawait setup(__filename,{data: {\n\tl01: {name: 'List'},\n\tt01: {name: 'Todo1',parents: {l01: 1}},\n\tt02: {name: 'Todo2',parents: {l01: 1}}\n}});\n\n\ntrue && OP.pub(List,async function(pub,item) {\n\t\n\tawait OP.filter({$parent: item});\n\treturn pub.add(item,pub.ALL);\n});\n\ntest.web(\"hello\",async function({l01: l01}) {\n\t\n\tlet sub = await OP.sub(l01);\n\treturn ok(sub.consumed.length == 3);\n});\n","dependencies":[],"map":{"version":3,"file":"pub.test.js","sourceRoot":"","sources":["/Users/sindre/repos/scrimba/op/test/pub.test.imba"],"sourcesContent":["import setup from './setup'\n\nexport class Item < OP.Object\n\tid @key\n\tcreator @ref(OP.User) = OP.user\n\tname @string\n\tnote @string.pov\n\titems @children(Item)\n\tparents @parents(List)\n\nexport class List < Item\n\tstatic alias = 'l'\n\ttodos @children(Todo)\n\nexport class Todo < Item\n\tstatic alias = 't'\n\towners @items(OP.User)\n\tname @string\n\tseen @toggle.pov\n\tlabels @zset(String)\n\twatchers @zset(OP.Client)\n\nawait setup(__filename, data: {\n\tl01: {name: 'List'}\n\tt01: {name: 'Todo1', parents: {l01: 1}}\n\tt02: {name: 'Todo2', parents: {l01: 1}}\n})\n\n\n$node$ and OP.pub(List) do(pub,item)\n\tawait OP.filter($parent: item)\n\tpub.add(item,pub.ALL)\n\ntest.web \"hello\" do({l01})\n\tlet sub = await OP.sub(l01)\n\tok sub.consumed.length == 3\n"],"names":[],"mappings":";;;;;;;;;;;AAAA,MAAM,CAAC,KAAK,MAAM,SAAS;;AAE3B,MAAM,CAAC,KAAK,CAAC,IAAI,SAAG,EAAE,CAAC,MAAM,EAAA;qCAF7B;;;sBAGC,EAAE,CAAA;sBACF,OAAO,CAAA;sBACP,IAAI,CAAA;sBACJ,IAAI,CAAA;sBACJ,KAAK,CAAA;sBACL,OAAO,CAAA;;EARR;cAAA;;;EAAA;kDAAA;;oCAGC,EAAE;yCACF,OAAO;sCACP,IAAI;sCACJ,IAAI;uCACJ,KAAK;yCACL,OAAO;;EARR;KAGC,EAAE;KAAF,EAAE;KAAF,IAAE,iDAAC,IAAI,EAAA,sBADK,IAAI;KAEhB,OAAO;KAAP,OAAO;KAAP,SAAO,iDAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,0BAJtB;EAIyB,OAAA,EAAE,CAAC,IAAI;EAJhC,2BAEa,IAAI;KAGhB,IAAI;KAAJ,IAAI;KAAJ,MAAI,iDAAC,OAAO,EAAA,wBAHA,IAAI;KAIhB,IAAI;KAAJ,IAAI;KAAJ,MAAI,iDAAC,OAAO,EAAA,MAAC,GAAG,4BAAH,GAAG,EAAA,QAAH,GAAG,gCAJJ,IAAI;KAKhB,KAAK;KAAL,KAAK;KAAL,OAAK,kDAAC,SAAS,CAAC,IAAI,CAAC,0BALT,IAAI;KAMhB,OAAO;KAAP,OAAO;KAAP,SAAO,kDAAC,QAAQ,CAAC,IAAI,CAAC,6BANV,IAAI;;;AAMM,CAAA;;AAEvB,MAAM,CAAC,KAAK,CAAC,IAAI,SAAG,IAAI,EAAA;qCAVxB;;;sBAYC,KAAK,CAAA;;EAZN;kDAAA;;uCAYC,KAAK;;EAZN;KAYC,KAAK;KAAL,KAAK;KAAL,OAAK,kDAAC,SAAS,CAAC,IAAI,CAAC,2BAFT,IAAI;;kCACT,KAAK,GAAG,GAAG;;AACG,CAAA;;AAEtB,MAAM,CAAC,KAAK,CAAC,IAAI,SAAG,IAAI,EAAA;qCAdxB;;;sBAgBC,MAAM,CAAA;sBACN,IAAI,CAAA;sBACJ,IAAI,CAAA;sBACJ,MAAM,CAAA;sBACN,QAAQ,CAAA;;EApBT;kDAAA;;wCAgBC,MAAM;sCACN,IAAI;sCACJ,IAAI;wCACJ,MAAM;0CACN,QAAQ;;EApBT;KAgBC,MAAM;KAAN,MAAM;KAAN,QAAM,kDAAC,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,4BAFV,IAAI;KAGhB,IAAI;KAAJ,IAAI;KAAJ,MAAI,kDAAC,OAAO,EAAA,0BAHA,IAAI;KAIhB,IAAI;KAAJ,IAAI;KAAJ,MAAI,kDAAC,OAAO,EAAA,MAAC,GAAG,4BAAH,GAAG,EAAA,QAAH,GAAG,kCAJJ,IAAI;KAKhB,MAAM;KAAN,MAAM;KAAN,QAAM,kDAAC,KAAK,CAAC,MAAM,CAAC,4BALR,IAAI;KAMhB,QAAQ;KAAR,QAAQ;KAAR,UAAQ,kDAAC,KAAK,CAAC,EAAE,CAAC,MAAM,CAAC,8BANb,IAAI;;kCACT,KAAK,GAAG,GAAG;;AAKO,CAAA;;MAEpB,KAAK,CAAC,UAAU,EAAE,IAAI,EAAE;CAC7B,GAAG,EAAE,CAAC,IAAI,EAAE,MAAM,CAAC;CACnB,GAAG,EAAE,CAAC,IAAI,EAAE,OAAO,CAAE,OAAO,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;CACvC,GAAG,EAAE,CAAC,IAAI,EAAE,OAAO,CAAE,OAAO,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;CACvC,EAAC;;;AAGF,IAAM,CAAC,EAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAAE,cAAE,CAAC,GAAG,CAAC,IAAI,EAAC;;OAC7B,EAAE,CAAC,MAAM,EAAC,OAAO,EAAE,IAAI,EAAC;CAC9B,OAAA,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC;CAAA,CAFC;;AAIvB,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,cAAE,CAAC,CAAC,GAAG,EAAH,GAAG,CAAC,EAAC;;KACrB,GAAG,SAAS,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC;CAC3B,OAAA,EAAE,CAAC,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,CAAA;CAAA,CAFpB;AAGR;"}},"css":{"code":""},"warnings":[],"errors":[]}
{"js":{"code":"function defineName$__(cls,name){\n\tObject.defineProperty(cls,\"name\",{value:name,configurable:true});\n};;\nfunction inheritClass$__(cls){\n\tObject.getPrototypeOf(cls.prototype).constructor?.inherited?.(cls);\n};\nimport {accessor as imba_accessor} from 'imba';\nvar $1 = Symbol('name'), $2 = Symbol(), $3 = Symbol('desc'), $4 = Symbol(), $5 = Symbol('owner'), $6 = Symbol(), $7 = Symbol(), $8 = Symbol('id'), $9 = Symbol(), $10 = Symbol('owner'), $11 = Symbol(), $12 = Symbol(), $14, $15, $16, $18, $19;\nconst $__init__$ = Symbol.for('#__init__'), $__patch__$ = Symbol.for('#__patch__'), $__initor__$ = Symbol.for('#__initor__'), $__inited__$ = Symbol.for('#__inited__'), $__hooks__$ = Symbol.for('#__hooks__');\n\n/*body*/\nimport setup from '../setup';\n\nclass Item extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $13;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($13 = $$.name) !== undefined && this.ααname.$init($13,this,$1,'name',$$);\n\t\tfields && ($13 = $$.desc) !== undefined && this.ααdesc.$init($13,this,$3,'desc',$$);\n\t\tfields && ($13 = $$.owner) !== undefined && this.ααowner.$init($13,this,$5,'owner',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$7 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααname.$init($$ ? $$.name : undefined,this,$1,'name',$$);\n\t\tfields && this.ααdesc.$init($$ ? $$.desc : undefined,this,$3,'desc',$$);\n\t\tfields && this.ααowner.$init($$ ? $$.owner : undefined,this,$5,'owner',$$);\n\t\t\n\t}\n\tset name(val){ this.ααname.$set(val,this,$1,'name') }\n\tget name(){ return this.ααname.$get(this,$1,'name') }\n\tget ααname(){ return this[$2] || imba_accessor(($14 = this.αstring(),$14),this,$1,'name',$2,Item.prototype) }\n\tset desc(val){ this.ααdesc.$set(val,this,$3,'desc') }\n\tget desc(){ return this.ααdesc.$get(this,$3,'desc') }\n\tget ααdesc(){ return this[$4] || imba_accessor(($15 = this.αstring(),($15.r instanceof Function) ? $15.r(OP.OWNER) : ($15.r = OP.OWNER),$15),this,$3,'desc',$4,Item.prototype) }\n\tset owner(val){ this.ααowner.$set(val,this,$5,'owner') }\n\tget owner(){ return this.ααowner.$get(this,$5,'owner') }\n\tget ααowner(){ return this[$6] || imba_accessor(($16 = this.αref(User),($16.as instanceof Function) ? $16.as(OP.OWNER) : ($16.as = OP.OWNER),$16),this,$5,'owner',$6,Item.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $7;defineName$__(this,'Item');inheritClass$__(this);}\n};\n\nclass Private extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $17;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($17 = $$.id) !== undefined && this.ααid.$init($17,this,$8,'id',$$);\n\t\tfields && ($17 = $$.owner) !== undefined && this.ααowner.$init($17,this,$10,'owner',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$12 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααid.$init($$ ? $$.id : undefined,this,$8,'id',$$);\n\t\tfields && this.ααowner.$init($$ ? $$.owner : undefined,this,$10,'owner',$$);\n\t\t\n\t}\n\tset id(val){ this.ααid.$set(val,this,$8,'id') }\n\tget id(){ return this.ααid.$get(this,$8,'id') }\n\tget ααid(){ return this[$9] || imba_accessor(($18 = this.αkey(),($18.r instanceof Function) ? $18.r(OP.OWNER) : ($18.r = OP.OWNER),$18),this,$8,'id',$9,Private.prototype) }\n\tset owner(val){ this.ααowner.$set(val,this,$10,'owner') }\n\tget owner(){ return this.ααowner.$get(this,$10,'owner') }\n\tget ααowner(){ return this[$11] || imba_accessor(($19 = this.αref(User),($19.as instanceof Function) ? $19.as(OP.OWNER) : ($19.as = OP.OWNER),$19),this,$10,'owner',$11,Private.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $12;defineName$__(this,'Private');inheritClass$__(this);}\n};\n\nclass User extends OP.User {\nstatic {\n\tdefineName$__(this,'User');inheritClass$__(this);}};\n\nawait setup(__filename,{\n\tdata: {\n\t\tU01: {},\n\t\tU02: {},\n\t\titem01: {name: 'name1',desc: 'desc1',owner: 'U01'},\n\t\titem02: {name: 'name2',desc: 'desc2',owner: 'U02'},\n\t\tprivate01: {owner: 'U01'},\n\t\tprivate02: {owner: 'U02'}\n\t}\n});\n\ndescribe(\"stuff\",async function() {\n\t\n\tlet item1 = await OP.get('item01');\n\tlet item2 = await OP.get('item02');\n\tlet private1 = await OP.get('private01');\n\tlet private2 = await OP.get('private02');\n\tlet user1 = await OP.get('U01');\n\tlet user2 = await OP.get('U02');\n\t\n\tlet item1user1 = item1.dehydrateΞfor(user1);\n\tlet item1user2 = item1.dehydrateΞfor(user2);\n\tlet item2user1 = item2.dehydrateΞfor(user1);\n\tlet item2user2 = item2.dehydrateΞfor(user2);\n\tlet private1user1 = private1.dehydrateΞfor(user1);\n\tlet private1user2 = private1.dehydrateΞfor(user2);\n\tlet private2user1 = private2.dehydrateΞfor(user1);\n\tlet private2user2 = private2.dehydrateΞfor(user2);\n\t\n\ttest(\"caching\",function() {\n\t\t\n\t\tok(item1.name,'name1');\n\t\tok(item1.desc,'desc1');\n\t\tok(item2.name,'name2');\n\t\tok(item2.desc,'desc2');\n\t\t\n\t\tok(item1user1,item1.dehydrateΞfor(user1));\n\t\tok(item1user2,item1.dehydrateΞfor(user2));\n\t\tok(item2user1,item2.dehydrateΞfor(user1));\n\t\treturn ok(item2user2,item2.dehydrateΞfor(user2));\n\t});\n\t\n\ttest(\"permissions\",function() {\n\t\t\n\t\tok(item1user1.name,'name1');\n\t\tok(item1user1.desc,'desc1');\n\t\t\n\t\tok(item1user2.name,'name1');\n\t\tok(item1user2.desc,undefined);\n\t\t\n\t\tok(item2user1.name,'name2');\n\t\tok(item2user1.desc,undefined);\n\t\t\n\t\tok(item2user2.name,'name2');\n\t\treturn ok(item2user2.desc,'desc2');\n\t});\n\t\n\ttest.node(\"cache invalidation\",function() {\n\t\t\n\t\titem1.owner = user2;\n\t\titem2.owner = user1;\n\t\t\n\t\t// Havent added nok in imba/spec yet\n\t\tnok(item1user1,item1.dehydrateΞfor(user1));\n\t\tnok(item1user2,item1.dehydrateΞfor(user2));\n\t\tnok(item2user1,item2.dehydrateΞfor(user1));\n\t\tnok(item2user2,item2.dehydrateΞfor(user2));\n\t\t\n\t\titem1user1 = item1.dehydrateΞfor(user1);\n\t\titem1user2 = item1.dehydrateΞfor(user2);\n\t\titem2user1 = item2.dehydrateΞfor(user1);\n\t\titem2user2 = item2.dehydrateΞfor(user2);\n\t\t\n\t\titem1.packΞfor(user1);\n\t\titem1.packΞfor(user1);\n\t\titem2.packΞfor(user1);\n\t\treturn item2.packΞfor(user1);\n\t});\n\t\n\treturn test(\"private\",function() {\n\t\t\n\t\tok(private1user1.id,'private01');\n\t\tok(private1user2,undefined);\n\t\tok(private2user1,undefined);\n\t\treturn ok(private2user2.id,'private02');\n\t});\n});\n","dependencies":[],"map":{"version":3,"file":"dehydrate.test.js","sourceRoot":"","sources":["/Users/sindre/repos/scrimba/op/test/misc/dehydrate.test.imba"],"sourcesContent":["import setup from '../setup'\n\nclass Item < OP.Object\n\tname @string\n\tdesc @string.r(OP.OWNER)\n\towner @ref(User).as(OP.OWNER)\n\nclass Private < OP.Object\n\tid @key.r(OP.OWNER)\n\towner @ref(User).as(OP.OWNER)\n\nclass User < OP.User\n\nawait setup(__filename, {\n\tdata: {\n\t\tU01: {}\n\t\tU02: {}\n\t\titem01: { name: 'name1', desc: 'desc1', owner: 'U01' }\n\t\titem02: { name: 'name2', desc: 'desc2', owner: 'U02' }\n\t\tprivate01: { owner: 'U01' }\n\t\tprivate02: { owner: 'U02' }\n\t}\n})\n\ndescribe \"stuff\" do\n\tlet item1 = await OP.get 'item01'\n\tlet item2 = await OP.get 'item02'\n\tlet private1 = await OP.get 'private01'\n\tlet private2 = await OP.get 'private02'\n\tlet user1 = await OP.get 'U01'\n\tlet user2 = await OP.get 'U02'\n\n\tlet item1user1 = item1.dehydrate-for(user1)\n\tlet item1user2 = item1.dehydrate-for(user2)\n\tlet item2user1 = item2.dehydrate-for(user1)\n\tlet item2user2 = item2.dehydrate-for(user2)\n\tlet private1user1 = private1.dehydrate-for(user1)\n\tlet private1user2 = private1.dehydrate-for(user2)\n\tlet private2user1 = private2.dehydrate-for(user1)\n\tlet private2user2 = private2.dehydrate-for(user2)\n\n\ttest \"caching\" do\n\t\tok item1.name, 'name1'\n\t\tok item1.desc, 'desc1'\n\t\tok item2.name, 'name2'\n\t\tok item2.desc, 'desc2'\n\n\t\tok item1user1, item1.dehydrate-for(user1)\n\t\tok item1user2, item1.dehydrate-for(user2)\n\t\tok item2user1, item2.dehydrate-for(user1)\n\t\tok item2user2, item2.dehydrate-for(user2)\n\n\ttest \"permissions\" do\n\t\tok item1user1.name, 'name1'\n\t\tok item1user1.desc, 'desc1'\n\n\t\tok item1user2.name, 'name1'\n\t\tok item1user2.desc, undefined\n\n\t\tok item2user1.name, 'name2'\n\t\tok item2user1.desc, undefined\n\n\t\tok item2user2.name, 'name2'\n\t\tok item2user2.desc, 'desc2'\n\n\ttest.node \"cache invalidation\" do\n\t\titem1.owner = user2\n\t\titem2.owner = user1\n\n\t\t# Havent added nok in imba/spec yet\n\t\tnok item1user1, item1.dehydrate-for(user1)\n\t\tnok item1user2, item1.dehydrate-for(user2)\n\t\tnok item2user1, item2.dehydrate-for(user1)\n\t\tnok item2user2, item2.dehydrate-for(user2)\n\n\t\titem1user1 = item1.dehydrate-for(user1)\n\t\titem1user2 = item1.dehydrate-for(user2)\n\t\titem2user1 = item2.dehydrate-for(user1)\n\t\titem2user2 = item2.dehydrate-for(user2)\n\n\t\titem1.pack-for(user1)\n\t\titem1.pack-for(user1)\n\t\titem2.pack-for(user1)\n\t\titem2.pack-for(user1)\n\n\ttest \"private\" do\n\t\tok private1user1.id, 'private01'\n\t\tok private1user2, undefined\n\t\tok private2user1, undefined\n\t\tok private2user2.id, 'private02'\n"],"names":[],"mappings":"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"}},"css":{"code":""},"warnings":[],"errors":[]}
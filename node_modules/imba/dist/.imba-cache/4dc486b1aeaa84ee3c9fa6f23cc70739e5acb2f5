{"js":{"code":"function defineName$__(cls,name){\n\tObject.defineProperty(cls,\"name\",{value:name,configurable:true});\n};;\nfunction inheritClass$__(cls){\n\tObject.getPrototypeOf(cls.prototype).constructor?.inherited?.(cls);\n};\nimport {accessor as imba_accessor} from 'imba';\nvar $1 = Symbol('score'), $2 = Symbol(), $3 = Symbol('rank'), $4 = Symbol(), $5 = Symbol(), $6 = Symbol('score'), $7 = Symbol(), $8 = Symbol('rank'), $9 = Symbol(), $10 = Symbol('deep'), $11 = Symbol(), $12 = Symbol(), $13 = Symbol('note'), $14 = Symbol(), $15 = Symbol(), $16 = Symbol('name'), $17 = Symbol(), $18 = Symbol('index'), $19 = Symbol(), $20 = Symbol(), $21 = Symbol('id'), $22 = Symbol(), $23 = Symbol('binary'), $24 = Symbol(), $25 = Symbol('creator'), $26 = Symbol(), $27 = Symbol('members'), $28 = Symbol(), $29 = Symbol('users'), $30 = Symbol(), $31 = Symbol('name'), $32 = Symbol(), $33 = Symbol('desc'), $34 = Symbol(), $35 = Symbol('stats'), $36 = Symbol(), $37 = Symbol('layers'), $38 = Symbol(), $39 = Symbol(), $41, $42, $44, $45, $46, $48, $50, $51, $53, $54, $55, $56, $57, $58, $59, $60, $61;\nconst $__init__$ = Symbol.for('#__init__'), $__patch__$ = Symbol.for('#__patch__'), $__initor__$ = Symbol.for('#__initor__'), $__inited__$ = Symbol.for('#__inited__'), $__hooks__$ = Symbol.for('#__hooks__');\n\n/*body*/\nimport setup from '../setup';\nimport nfs from 'fs';\n\nclass ItemStatsDeep extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $40;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($40 = $$.score) !== undefined && this.ααscore.$init($40,this,$1,'score',$$);\n\t\tfields && ($40 = $$.rank) !== undefined && this.ααrank.$init($40,this,$3,'rank',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$5 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααscore.$init($$ ? $$.score : undefined,this,$1,'score',$$);\n\t\tfields && this.ααrank.$init($$ ? $$.rank : undefined,this,$3,'rank',$$);\n\t\t\n\t}\n\tset score(val){ this.ααscore.$set(val,this,$1,'score') }\n\tget score(){ return this.ααscore.$get(this,$1,'score') }\n\tget ααscore(){ return this[$2] || imba_accessor(($41 = this.αnumber(),$41),this,$1,'score',$2,ItemStatsDeep.prototype) }\n\tset rank(val){ this.ααrank.$set(val,this,$3,'rank') }\n\tget rank(){ return this.ααrank.$get(this,$3,'rank') }\n\tget ααrank(){ return this[$4] || imba_accessor(($42 = this.αnumber(),$42),this,$3,'rank',$4,ItemStatsDeep.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $5;defineName$__(this,'ItemStatsDeep');inheritClass$__(this);}\n};\n\nclass ItemStats extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $43;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($43 = $$.score) !== undefined && this.ααscore.$init($43,this,$6,'score',$$);\n\t\tfields && ($43 = $$.rank) !== undefined && this.ααrank.$init($43,this,$8,'rank',$$);\n\t\tfields && ($43 = $$.deep) !== undefined && this.ααdeep.$init($43,this,$10,'deep',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$12 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααscore.$init($$ ? $$.score : undefined,this,$6,'score',$$);\n\t\tfields && this.ααrank.$init($$ ? $$.rank : undefined,this,$8,'rank',$$);\n\t\tfields && this.ααdeep.$init($$ ? $$.deep : undefined,this,$10,'deep',$$);\n\t\t\n\t}\n\tset score(val){ this.ααscore.$set(val,this,$6,'score') }\n\tget score(){ return this.ααscore.$get(this,$6,'score') }\n\tget ααscore(){ return this[$7] || imba_accessor(($44 = this.αnumber(),$44),this,$6,'score',$7,ItemStats.prototype) }\n\tset rank(val){ this.ααrank.$set(val,this,$8,'rank') }\n\tget rank(){ return this.ααrank.$get(this,$8,'rank') }\n\tget ααrank(){ return this[$9] || imba_accessor(($45 = this.αnumber(),$45),this,$8,'rank',$9,ItemStats.prototype) }\n\tset deep(val){ this.ααdeep.$set(val,this,$10,'deep') }\n\tget deep(){ return this.ααdeep.$get(this,$10,'deep') }\n\tget ααdeep(){ return this[$11] || imba_accessor(($46 = this.αembed(ItemStatsDeep),$46),this,$10,'deep',$11,ItemStats.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $12;defineName$__(this,'ItemStats');inheritClass$__(this);}\n};\n\nclass CustomBinary extends OP.Blob {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $47;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($47 = $$.note) !== undefined && this.ααnote.$init($47,this,$13,'note',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$15 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααnote.$init($$ ? $$.note : undefined,this,$13,'note',$$);\n\t\t\n\t}\n\tset note(val){ this.ααnote.$set(val,this,$13,'note') }\n\tget note(){ return this.ααnote.$get(this,$13,'note') }\n\tget ααnote(){ return this[$14] || imba_accessor(($48 = this.αstring(),$48),this,$13,'note',$14,CustomBinary.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $15;defineName$__(this,'CustomBinary');inheritClass$__(this);}\n};\n\nclass LayerSettings extends OP.Object {\nstatic {\n\tdefineName$__(this,'LayerSettings');inheritClass$__(this);}};\n\n// inherit from OPEmbed for optimized embeddable object - that doesnt create a table\n// and is not setup for other causes\nclass Layer extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $49;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($49 = $$.name) !== undefined && this.ααname.$init($49,this,$16,'name',$$);\n\t\tfields && ($49 = $$.index) !== undefined && this.ααindex.$init($49,this,$18,'index',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$20 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααname.$init($$ ? $$.name : undefined,this,$16,'name',$$);\n\t\tfields && this.ααindex.$init($$ ? $$.index : undefined,this,$18,'index',$$);\n\t\t\n\t}\n\tset name(val){ this.ααname.$set(val,this,$16,'name') }\n\tget name(){ return this.ααname.$get(this,$16,'name') }\n\tget ααname(){ return this[$17] || imba_accessor(($50 = this.αstring(),$50),this,$16,'name',$17,Layer.prototype) }\n\tset index(val){ this.ααindex.$set(val,this,$18,'index') }\n\tget index(){ return this.ααindex.$get(this,$18,'index') }\n\tget ααindex(){ return this[$19] || imba_accessor(($51 = this.αnumber(),$51),this,$18,'index',$19,Layer.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $20;defineName$__(this,'Layer');inheritClass$__(this);}\n};\n\nexport class Item extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $52;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($52 = $$.id) !== undefined && this.ααid.$init($52,this,$21,'id',$$);\n\t\tfields && ($52 = $$.binary) !== undefined && this.ααbinary.$init($52,this,$23,'binary',$$);\n\t\tfields && ($52 = $$.creator) !== undefined && this.ααcreator.$init($52,this,$25,'creator',$$);\n\t\tfields && ($52 = $$.members) !== undefined && this.ααmembers.$init($52,this,$27,'members',$$);\n\t\tfields && ($52 = $$.users) !== undefined && this.ααusers.$init($52,this,$29,'users',$$);\n\t\tfields && ($52 = $$.name) !== undefined && this.ααname.$init($52,this,$31,'name',$$);\n\t\tfields && ($52 = $$.desc) !== undefined && this.ααdesc.$init($52,this,$33,'desc',$$);\n\t\tfields && ($52 = $$.stats) !== undefined && this.ααstats.$init($52,this,$35,'stats',$$);\n\t\tfields && ($52 = $$.layers) !== undefined && this.ααlayers.$init($52,this,$37,'layers',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$39 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααid.$init($$ ? $$.id : undefined,this,$21,'id',$$);\n\t\tfields && this.ααbinary.$init($$ ? $$.binary : undefined,this,$23,'binary',$$);\n\t\tfields && this.ααcreator.$init($$ ? $$.creator : undefined,this,$25,'creator',$$);\n\t\tfields && this.ααmembers.$init($$ ? $$.members : undefined,this,$27,'members',$$);\n\t\tfields && this.ααusers.$init($$ ? $$.users : undefined,this,$29,'users',$$);\n\t\tfields && this.ααname.$init($$ ? $$.name : undefined,this,$31,'name',$$);\n\t\tfields && this.ααdesc.$init($$ ? $$.desc : undefined,this,$33,'desc',$$);\n\t\tfields && this.ααstats.$init($$ ? $$.stats : undefined,this,$35,'stats',$$);\n\t\tfields && this.ααlayers.$init($$ ? $$.layers : undefined,this,$37,'layers',$$);\n\t\t\n\t}\n\tset id(val){ this.ααid.$set(val,this,$21,'id') }\n\tget id(){ return this.ααid.$get(this,$21,'id') }\n\tget ααid(){ return this[$22] || imba_accessor(($53 = this.αkey(),$53),this,$21,'id',$22,Item.prototype) }\n\tset binary(val){ this.ααbinary.$set(val,this,$23,'binary') }\n\tget binary(){ return this.ααbinary.$get(this,$23,'binary') }\n\tget ααbinary(){ return this[$24] || imba_accessor(($54 = this.αembed(CustomBinary),$54),this,$23,'binary',$24,Item.prototype) }\n\tset creator(val){ this.ααcreator.$set(val,this,$25,'creator') }\n\tget creator(){ return this.ααcreator.$get(this,$25,'creator') }\n\tget ααcreator(){ return this[$26] || imba_accessor(($55 = this.αref(OP.User),($55.as instanceof Function) ? $55.as(OP.OWNER) : ($55.as = OP.OWNER),$55.default = function() {\n\t\treturn OP.user;\n\t},$55),this,$25,'creator',$26,Item.prototype) }\n\tset members(val){ this.ααmembers.$set(val,this,$27,'members') }\n\tget members(){ return this.ααmembers.$get(this,$27,'members') }\n\tget ααmembers(){ return this[$28] || imba_accessor(($56 = this.αzset(OP.User),($56.as instanceof Function) ? $56.as(OP.MEMBER) : ($56.as = OP.MEMBER),$56),this,$27,'members',$28,Item.prototype) }\n\tset users(val){ this.ααusers.$set(val,this,$29,'users') }\n\tget users(){ return this.ααusers.$get(this,$29,'users') }\n\tget ααusers(){ return this[$30] || imba_accessor(($57 = this.αzset(OP.User),$57),this,$29,'users',$30,Item.prototype) }\n\tset name(val){ this.ααname.$set(val,this,$31,'name') }\n\tget name(){ return this.ααname.$get(this,$31,'name') }\n\tget ααname(){ return this[$32] || imba_accessor(($58 = this.αstring(),$58),this,$31,'name',$32,Item.prototype) }\n\tset desc(val){ this.ααdesc.$set(val,this,$33,'desc') }\n\tget desc(){ return this.ααdesc.$get(this,$33,'desc') }\n\tget ααdesc(){ return this[$34] || imba_accessor(($59 = this.αstring(),$59),this,$33,'desc',$34,Item.prototype) }\n\tset stats(val){ this.ααstats.$set(val,this,$35,'stats') }\n\tget stats(){ return this.ααstats.$get(this,$35,'stats') }\n\tget ααstats(){ return this[$36] || imba_accessor(($60 = this.αembed(ItemStats),$60),this,$35,'stats',$36,Item.prototype) }\n\tset layers(val){ this.ααlayers.$set(val,this,$37,'layers') }\n\tget layers(){ return this.ααlayers.$get(this,$37,'layers') }\n\tget ααlayers(){ return this[$38] || imba_accessor(($61 = this.αembeds(Layer),$61),this,$37,'layers',$38,Item.prototype) }// multiple embeds\n\t\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $39;defineName$__(this,'Item');inheritClass$__(this);}\n};\n\nawait setup(__filename,{data: {\n\t// U01: {name: 'Sindre'}\n\t\t// U02: {name: 'Mikey'}\n\t\t// U03: {name: 'Frode'}\n\t\t// U04: {name: 'Abdellah'}\n\t\titem01: {name: 'Item',creator: 'U02'},\n\titem02: {name: 'Item',creator: 'U02'},\n\titem03: {name: 'Item',creator: 'U02',stats: {rank: 10,deep: {score: 20}}},\n\t\n\titem04: {name: 'Item',creator: 'U02',layers: {\n\t\tlayer01: {name: \"Layer1\"},\n\t\tlayer02: {name: \"Layer2\"}\n\t}},\n\t\n\titem: function() {\n\t\t\n\t\treturn Item.create({name: 'Item',creator: 'U02',layers: {\n\t\t\tlayer01: {name: \"Layer1\"},\n\t\t\tlayer02: {name: \"Layer2\"}\n\t\t}});\n\t},\n\t\n\tblank: function() { return Item.create({name: 'Item',creator: 'U02',layers: {}}); }\n}});\n\n// OPEmbed should inherit from OPObject but be specialized for embedding\n// No table should be created for them in postgres etc.\n\n// describe \"@embed(Blob)\" do\n\ntest.node(\"custom blob\",async function() {\n\t\n\tok(1);\n\t// return\n\tlet item = await Item.create({binary: {}});\n\tok(item.savedΦ);\n\t\n\tawait item.binary.append(\"1234\");\n\tawait item.binary.append(\"56\");\n\t\n\titem.binary.note = \"Hello\";\n\tawait item.save();\n\tlet res = await item.binary.read();\n\tok(res instanceof BinaryChunk);\n\treturn ok(Buffer.from(res.data).toString('utf8'),\"123456\");\n});\n\n// TEST patching data\n\ntest(\"awakening\",async function({item: item}) {\n\t\n\tlet layer = item.layers[0];\n\tok(item.layers.size,2);\n\tok(layer instanceof Layer);\n\tok(layer.$plain.name,\"Layer1\");\n\tlayer.name = \"Renamed\";\n\tawait item.save();\n\tnull;\n\treturn ok(layer.$cloud.name,\"Renamed\");\n});\n\ntest(\"adding wrong type\",function({sindre: sindre,item: item}) {\n\t\n\treturn ok((()=>{ try { return item.layers.add(sindre) } catch(e) { return e; } })() instanceof Error);\n});\n\ntest(\"embeds.create\",async function({sindre: sindre}) {\n\t\n\tlet item = await Item.create({name: 'Item',creator: sindre});\n\tok(item.persistedΦ);\n\t\n\tlet res = await item.layers.create({name: \"Hello\"});\n\tok(res instanceof Layer);\n\tok(!(res.unsavedΦ));\n\t// already saved\n\tawait item.save();\n\treturn ok(item.layers.size,1);\n});\n\ntest(\"create with data\",function() {\n\t\n\tlet item = Item.build({stats: {score: 2},layers: {\n\t\tlayer01: {name: 'a'}\n\t}});\n\tok(item.stats.score,2);\n\treturn ok(item.layers.size,1);\n});\n\ntest(\"creation\",function({item: item}) {\n\t\n\tlet l1 = item.layers.get('layer01');\n\t// need to use the same objects?\n\tok(l1.$diff(),[]);\n\treturn ok(l1.$cloud,l1.$plain);\n});\n\ntest.todo(\"only save created embeds\",async function() {\n\t\n\t// Doesnt work yet\n\tlet item = await Item.build({name: 'Item',creator: 'U01'});\n\tok(item.$plain);\n\tawait item.save();\n\t// Adding layers\n\tlet l1 = item.layers.add({name: \"1\"});\n\tok(l1 instanceof Layer);\n\t\n\t// added layers should be saved when saving parent\n\t// unless the sublayer is marked as draft/new\n\t\n\tlet l2 = item.layers.new({name: \"2\"});\n\t\n\tawait item.save();\n\tok(item.persistedΦ);\n\tok(l1.persistedΦ);\n\treturn ok(!(l2.persistedΦ));\n});\n\ntest(\"save embed changes separately\",async function() {\n\t\n\tlet item = await Item.create({name: 'Item',creator: 'U01'});\n\tok(item.persistedΦ);\n\tlet l1 = item.layers.create({name: \"1\"});\n\tok(item.persistedΦ);\n\t// can we await it?\n\tawait l1.save();\n\tok(l1.$cloud.name,\"1\");\n\t\n\titem.name = \"Other\";\n\tl1.name = \"renamed\";\n\t\n\tok(l1.$cloud.name,\"1\");\n\tok(l1.$plain.name,\"renamed\");\n\tok(l1.unsavedΦ);\n\tok(item.unsavedΦ);\n\t\n\tawait l1.save();\n\t\n\tok(l1.$cloud.name,\"renamed\");\n\tok(item.$cloud.name,'Item');\n\treturn ok(item.unsavedΦ);\n});\n\ntest(\"embeds.add\",async function({U01: U01,item: item}) {\n\t\n\tlet layer = new Layer({name: \"Layer3\"});\n\titem.layers.add(layer);\n\tawait item.save();\n\tok(!(OP.$rich[layer.id]));\n\titem.layers.add({name: \"Layer4\"});\n\t// items should not be registered\n\tok(Layer.all().size,0);\n\treturn await item.save();\n});\n\ntest(\"embeds.add new\",async function({item: item}) {\n\t\n\tlet layer = new Layer({name: \"Layer3\"});\n\titem.layers.add(layer);\n\treturn await item.save();\n});\n\ntest(\"clone layers\",async function({item04: item04,item: item}) {\n\t\n\tlet layer = item04.layers.at(0);\n\tok(layer.name,\"Layer1\");\n\tok((()=>{ try { return item.layers.add(layer) } catch(e) { return e; } })() instanceof OPError);\n\tlet l2 = item.layers.add(layer.clone());\n\tawait item.save();\n\tok(item.layers.size,3);\n\treturn ok(Object.keys(item.$cloud.layers).length,3);\n});\n\ntest(\"deep patching\",async function({item: item}) {\n\t\n\tlet layer = item.layers.get('layer01');\n\tok(item.persistedΦ);\n\tok(layer.name,\"Layer1\");\n\t\n\tlet upd = await OP.db.update(item.id,{'layers.layer01.name': \"Renamed\"});\n\titem.$patch(upd);\n\treturn ok(layer.name,\"Renamed\");\n});\n\ntest(\"add patching\",async function({item: item}) {\n\t\n\tlet upd = await OP.db.update(item.id,{'layers.layer05': {name: \"5\"}});\n\titem.$patch(upd);\n\tlet l5 = item.layers.layer05;\n\tok(l5);\n\treturn ok(l5.name,\"5\");\n});\n\ntest(\"saving embedded item\",async function() {\n\t\n\tlet item = Item.build();\n\tok(!(item.persistedΦ));\n\tlet l1 = item.layers.add({name: \"1\"});\n\t// This should definitely not add anything to the db\n\tawait l1.save();\n\tok(!(l1.persistedΦ));\n\tawait item.save();\n\treturn ok(l1.persistedΦ);\n});\n\ntest(\"saving\",async function() {\n\t\n\tlet item = Item.build();\n\tok(!(item.persistedΦ));\n\tlet l1 = item.layers.add({name: \"1\"});\n\tok(!(l1.persistedΦ));\n\tok(l1.embedΦ);\n\tl1.name = \"11\";\n\tok(!(l1.persistedΦ));\n\tawait item.save();\n\tok(item.persistedΦ);\n\treturn ok(l1.persistedΦ);\n});\n\ntest(\"restting deep embed\",async function() {\n\tlet item;\n\t\n\treturn item = await Item.create({name: 'Item',layers: {\n\t\tlayer01: {name: \"Layer1\"}\n\t}});\n});\n\ntest(\"deleted\",async function() {\n\t\n\tlet item = await Item.create({name: 'Item',creator: 'U01',layers: {\n\t\tlayer01: {name: \"Layer1\"},\n\t\tlayer02: {name: \"Layer2\",_del: 10}\n\t}});\n\tlet l2 = item.layers.get(\"layer02\");\n\tok(l2.deletedΦ);\n\tok(!(l2.existsΦ));\n\t// Should it actually be hidden from the list of layers?\n\treturn ok(item.layers.size,1);\n});\n\ntest(\"delete layer\",async function({item: item}) {\n\t\n\tlet l1 = item.layers.get(\"layer01\");\n\tok(l1.$cloud,l1.$plain);\n\tl1.destroy();\n\tawait l1.save();\n\tok(l1.deletedΦ);\n\treturn ok(!(l1.existsΦ));\n});\n","dependencies":[],"map":{"version":3,"file":"embeds.test.js","sourceRoot":"","sources":["/Users/sindre/repos/scrimba/op/test/fields/embeds.test.imba"],"sourcesContent":["import setup from '../setup'\nimport nfs from 'fs'\n\nclass ItemStatsDeep < OP.Object\n\tscore @number\n\trank @number\n\nclass ItemStats < OP.Object\n\tscore @number\n\trank @number\n\tdeep @embed(ItemStatsDeep)\n\nclass CustomBinary < OP.Blob\n\tnote @string\n\nclass LayerSettings < OP.Object\n\n# inherit from OPEmbed for optimized embeddable object - that doesnt create a table\n# and is not setup for other causes\nclass Layer < OP.Object\n\tname @string\n\tindex @number\n\nexport class Item < OP.Object\n\tid @key\n\tbinary @embed(CustomBinary)\n\tcreator @ref(OP.User).as(OP.OWNER) = OP.user\n\tmembers @zset(OP.User).as(OP.MEMBER)\n\tusers @zset(OP.User)\n\tname @string\n\tdesc @string\n\tstats @embed(ItemStats)\n\tlayers @embeds(Layer) # multiple embeds\n\nawait setup(__filename, data: {\n\t# U01: {name: 'Sindre'}\n\t# U02: {name: 'Mikey'}\n\t# U03: {name: 'Frode'}\n\t# U04: {name: 'Abdellah'}\n\titem01: {name: 'Item', creator: 'U02'}\n\titem02: {name: 'Item', creator: 'U02'}\n\titem03: {name: 'Item', creator: 'U02', stats: {rank: 10, deep: {score: 20}}}\n\n\titem04: {name: 'Item', creator: 'U02', layers: {\n\t\tlayer01: {name: \"Layer1\"}\n\t\tlayer02: {name: \"Layer2\"}\n\t}}\n\n\titem: do\n\t\tItem.create {name: 'Item', creator: 'U02', layers: {\n\t\t\tlayer01: {name: \"Layer1\"}\n\t\t\tlayer02: {name: \"Layer2\"}\n\t\t}}\n\n\tblank: do Item.create {name: 'Item', creator: 'U02', layers: {}}\n})\n\n# OPEmbed should inherit from OPObject but be specialized for embedding\n# No table should be created for them in postgres etc.\n\n# describe \"@embed(Blob)\" do\n\ntest.node \"custom blob\" do\n\tok 1\n\t# return\n\tlet item = await Item.create(binary: {})\n\tok item.saved?\n\n\tawait item.binary.append(\"1234\")\n\tawait item.binary.append(\"56\")\n\n\titem.binary.note = \"Hello\"\n\tawait item.save!\n\tlet res = await item.binary.read!\n\tok res isa BinaryChunk\n\tok Buffer.from(res.data).toString('utf8'),\"123456\"\n\n# TEST patching data\n\ntest \"awakening\" do({item})\n\tlet layer = item.layers[0]\n\tok item.layers.size,2\n\tok layer isa Layer\n\tok layer.$plain.name,\"Layer1\"\n\tlayer.name = \"Renamed\"\n\tawait item.save!\n\tnull\n\tok layer.$cloud.name,\"Renamed\"\n\ntest \"adding wrong type\" do({sindre,item})\n\tok rescue(item.layers.add(sindre)) isa Error\n\ntest \"embeds.create\" do({sindre})\n\tlet item = await Item.create({name: 'Item', creator: sindre})\n\tok item.persisted?\n\n\tlet res = await item.layers.create(name: \"Hello\")\n\tok res isa Layer\n\tok !res.unsaved?\n\t# already saved\n\tawait item.save!\n\tok item.layers.size,1\n\ntest \"create with data\" do\n\tlet item = Item.build(stats: {score: 2}, layers: {\n\t\tlayer01: {name: 'a'}\n\t})\n\tok item.stats.score,2\n\tok item.layers.size,1\n\ntest \"creation\" do({item})\n\tlet l1 = item.layers.get('layer01')\n\t# need to use the same objects?\n\tok l1.$diff!,[]\n\tok l1.$cloud,l1.$plain\n\ntest.todo \"only save created embeds\" do\n\t# Doesnt work yet\n\tlet item = await Item.build(name: 'Item', creator: 'U01')\n\tok item.$plain\n\tawait item.save!\n\t# Adding layers\n\tlet l1 = item.layers.add(name: \"1\")\n\tok l1 isa Layer\n\n\t# added layers should be saved when saving parent\n\t# unless the sublayer is marked as draft/new\n\n\tlet l2 = item.layers.new(name: \"2\")\n\n\tawait item.save!\n\tok item.persisted?\n\tok l1.persisted?\n\tok !l2.persisted?\n\ntest \"save embed changes separately\" do\n\tlet item = await Item.create(name: 'Item', creator: 'U01')\n\tok item.persisted?\n\tlet l1 = item.layers.create(name: \"1\")\n\tok item.persisted?\n\t# can we await it?\n\tawait l1.save!\n\tok l1.$cloud.name,\"1\"\n\n\titem.name = \"Other\"\n\tl1.name = \"renamed\"\n\n\tok l1.$cloud.name,\"1\"\n\tok l1.$plain.name,\"renamed\"\n\tok l1.unsaved?\n\tok item.unsaved?\n\n\tawait l1.save!\n\n\tok l1.$cloud.name,\"renamed\"\n\tok item.$cloud.name,'Item'\n\tok item.unsaved?\n\ntest \"embeds.add\" do({U01,item})\n\tlet layer = new Layer(name: \"Layer3\")\n\titem.layers.add(layer)\n\tawait item.save!\n\tok !OP.$rich[layer.id]\n\titem.layers.add(name: \"Layer4\")\n\t# items should not be registered\n\tok Layer.all!.size, 0\n\tawait item.save!\n\ntest \"embeds.add new\" do({item})\n\tlet layer = new Layer(name: \"Layer3\")\n\titem.layers.add(layer)\n\tawait item.save!\n\ntest \"clone layers\" do({item04,item})\n\tlet layer = item04.layers.at(0)\n\tok layer.name,\"Layer1\"\n\tok (rescue item.layers.add(layer)) isa OPError\n\tlet l2 = item.layers.add(layer.clone!)\n\tawait item.save!\n\tok item.layers.size,3\n\tok Object.keys(item.$cloud.layers).length,3\n\ntest \"deep patching\" do({item})\n\tlet layer = item.layers.get('layer01')\n\tok item.persisted?\n\tok layer.name, \"Layer1\"\n\n\tlet upd = await OP.db.update(item.id,{'layers.layer01.name': \"Renamed\"})\n\titem.$patch(upd)\n\tok layer.name,\"Renamed\"\n\ntest \"add patching\" do({item})\n\tlet upd = await OP.db.update(item.id,{'layers.layer05': {name: \"5\"}})\n\titem.$patch(upd)\n\tlet l5 = item.layers['layer05']\n\tok l5\n\tok l5.name,\"5\"\n\ntest \"saving embedded item\" do\n\tlet item = Item.build()\n\tok !item.persisted?\n\tlet l1 = item.layers.add(name: \"1\")\n\t# This should definitely not add anything to the db\n\tawait l1.save!\n\tok !l1.persisted?\n\tawait item.save!\n\tok l1.persisted?\n\ntest \"saving\" do\n\tlet item = Item.build()\n\tok !item.persisted?\n\tlet l1 = item.layers.add(name: \"1\")\n\tok !l1.persisted?\n\tok l1.embed?\n\tl1.name = \"11\"\n\tok !l1.persisted?\n\tawait item.save!\n\tok item.persisted?\n\tok l1.persisted?\n\ntest \"restting deep embed\" do\n\tlet item = await Item.create name: 'Item', layers: {\n\t\tlayer01: {name: \"Layer1\"}\n\t}\n\ntest \"deleted\" do\n\tlet item = await Item.create {name: 'Item', creator: 'U01', layers: {\n\t\tlayer01: {name: \"Layer1\"}\n\t\tlayer02: {name: \"Layer2\",_del: 10}\n\t}}\n\tlet l2 = item.layers.get(\"layer02\")\n\tok l2.deleted?\n\tok !l2.exists?\n\t# Should it actually be hidden from the list of layers?\n\tok item.layers.size,1\n\ntest \"delete layer\" do({item})\n\tlet l1 = item.layers.get(\"layer01\")\n\tok l1.$cloud,l1.$plain\n\tl1.destroy!\n\tawait l1.save!\n\tok l1.deleted?\n\tok !l1.exists?\n"],"names":[],"mappings":"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"}},"css":{"code":""},"warnings":[],"errors":[]}
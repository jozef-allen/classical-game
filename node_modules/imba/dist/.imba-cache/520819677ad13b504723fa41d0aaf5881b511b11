{"js":{"code":"function defineName$__(cls,name){\n\tObject.defineProperty(cls,\"name\",{value:name,configurable:true});\n};;\nfunction inheritClass$__(cls){\n\tObject.getPrototypeOf(cls.prototype).constructor?.inherited?.(cls);\n};\nimport {accessor as imba_accessor} from 'imba';\nvar $1 = Symbol('number'), $2 = Symbol(), $3 = Symbol(), $4 = Symbol('author'), $5 = Symbol(), $6 = Symbol(), $8, $10;\nconst $__init__$ = Symbol.for('#__init__'), $__patch__$ = Symbol.for('#__patch__'), $__initor__$ = Symbol.for('#__initor__'), $__inited__$ = Symbol.for('#__inited__'), $__hooks__$ = Symbol.for('#__hooks__');\n\n/*body*/\nimport setup from '../setup';\n\nclass Main extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $7;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($7 = $$.number) !== undefined && this.ααnumber.$init($7,this,$1,'number',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$3 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααnumber.$init($$ ? $$.number : undefined,this,$1,'number',$$);\n\t\t\n\t}\n\tset number(val){ this.ααnumber.$set(val,this,$1,'number') }\n\tget number(){ return this.ααnumber.$get(this,$1,'number') }\n\tget ααnumber(){ return this[$2] || imba_accessor(($8 = this.αint(),$8),this,$1,'number',$2,Main.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $3;defineName$__(this,'Main');inheritClass$__(this);}\n};\n\nclass Item extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $9;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($9 = $$.author) !== undefined && this.ααauthor.$init($9,this,$4,'author',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$6 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααauthor.$init($$ ? $$.author : undefined,this,$4,'author',$$);\n\t\t\n\t}\n\tset author(val){ this.ααauthor.$set(val,this,$4,'author') }\n\tget author(){ return this.ααauthor.$get(this,$4,'author') }\n\tget ααauthor(){ return this[$5] || imba_accessor(($10 = this.αref(OP.User),$10.default = function() {\n\t\treturn OP.user;\n\t},$10),this,$4,'author',$5,Item.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $6;defineName$__(this,'Item');inheritClass$__(this);}\n};\n\nawait setup(__filename,{data: [\n\t{id: 'U01',name: 'Sindre'}\n]});\n\ntest(\"with-context\",async function() {\n\t\n\tok(OP.agent,undefined);\n\tlet u = await OP.get('U01');\n\tok(u instanceof OP.User);\n\tok(u.name,'Sindre');\n\t\n\tOP.withΞcontext(u,function() {\n\t\t\n\t\tsetTimeout(function() {\n\t\t\t\n\t\t\treturn ok(OP.agent,u);\n\t\t},50);\n\t\treturn ok(OP.agent,u);\n\t});\n\tok(OP.agent,undefined);\n\t\n\tawait globalThis.sleep(60);\n\t\n\treturn OP.withΞcontext(u,function() {\n\t\t\n\t\t\n\t\tlet item = Item.build();\n\t\t// the author is by default set to the user\n\t\tok(item.author,u);\n\t\treturn OP.withΞcontext({stuff: 10},function() {\n\t\t\t\n\t\t\tok(OP.context.stuff,10);\n\t\t\treturn ok(OP.agent,u);\n\t\t});\n\t});\n});\n\n/*\n\tawait OP.with-context(sindre) do\n\t\tok fzi.usernote, \"Note by Sindre\"\n\n\tawait OP.with-context(mikey) do\n\t\tok fzi.usernote, \"Note by Mikey\"\n\ntest \"basic pov\" do\n\tawait OP.with-context(sindre) do\n\t\tok fzi.username\n\t\tjournal.usernote = \"Hello\"\n\t\t# await OP.save! ?\n\t\tawait journal.$pov(sindre).save!\n\t\t# await OP.save!\n*/\n\n","dependencies":[],"map":{"version":3,"file":"context.node.test.js","sourceRoot":"","sources":["/Users/sindre/repos/scrimba/op/test/core/context.node.test.imba"],"sourcesContent":["import setup from '../setup'\n\nclass Main < OP.Object\n\tnumber @int\n\nclass Item < OP.Object\n\tauthor @ref(OP.User) = OP.user\n\nawait setup(__filename, data: [\n\t{id: 'U01', name: 'Sindre'}\n])\n\ntest \"with-context\" do\n\tok OP.agent, undefined\n\tlet u = await OP.get('U01')\n\tok u isa OP.User\n\tok u.name, 'Sindre'\n\n\tOP.with-context(u) do\n\t\tsetTimeout(&,50) do\n\t\t\tok OP.agent,u\n\t\tok OP.agent,u\n\tok OP.agent, undefined\n\n\tawait global.sleep(60ms)\n\n\tOP.with-context(u) do\n\n\t\tlet item = Item.build()\n\t\t# the author is by default set to the user\n\t\tok item.author, u\n\t\tOP.with-context({stuff: 10}) do\n\t\t\tok OP.context.stuff,10\n\t\t\tok OP.agent, u\n\n###\n\tawait OP.with-context(sindre) do\n\t\tok fzi.usernote, \"Note by Sindre\"\n\n\tawait OP.with-context(mikey) do\n\t\tok fzi.usernote, \"Note by Mikey\"\n\ntest \"basic pov\" do\n\tawait OP.with-context(sindre) do\n\t\tok fzi.username\n\t\tjournal.usernote = \"Hello\"\n\t\t# await OP.save! ?\n\t\tawait journal.$pov(sindre).save!\n\t\t# await OP.save!\n###\n"],"names":[],"mappings":";;;;;;;;;;;AAAA,MAAM,CAAC,KAAK,MAAM,UAAU;;AAE5B,KAAK,CAAC,IAAI,SAAG,EAAE,CAAC,MAAM,EAAA;qCAFtB;;;qBAGC,MAAM,CAAA;;EAHP;cAAA;;;EAAA;kDAAA;;wCAGC,MAAM;;EAHP;KAGC,MAAM;KAAN,MAAM;KAAN,QAAM,gDAAC,IAAI,EAAA,yBADN,IAAI;;;AACE,CAAA;;AAEZ,KAAK,CAAC,IAAI,SAAG,EAAE,CAAC,MAAM,EAAA;qCALtB;;;qBAMC,MAAM,CAAA;;EANP;cAAA;;;EAAA;kDAAA;;wCAMC,MAAM;;EANP;KAMC,MAAM;KAAN,MAAM;KAAN,QAAM,iDAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,0BANrB;EAMwB,OAAA,EAAE,CAAC,IAAI;EAN/B,0BAKM,IAAI;;;AACqB,CAAA;;MAEzB,KAAK,CAAC,UAAU,EAAE,IAAI,EAAE,CAC7B;CAAA,CAAC,EAAE,EAAE,KAAK,CAAE,IAAI,EAAE,QAAQ,CAAC;AAAA,CAC3B,EAAC;;AAEF,IAAI,CAAC,cAAc,CAAC,cAAE,GAAA;;CACrB,EAAE,CAAC,EAAE,CAAC,KAAK,CAAE,SAAS,CAAA;KAClB,CAAC,SAAS,EAAE,CAAC,GAAG,CAAC,KAAK,CAAC;CAC3B,EAAE,CAAC,CAAC,YAAK,EAAE,CAAC,IAAI,CAAA;CAChB,EAAE,CAAC,CAAC,CAAC,IAAI,CAAE,QAAQ,CAAA;;CAEnB,EAAE,CAAC,YAAY,CAAC,CAAC,CAAE,QAAE,GAAA;;EACpB,UAAU,CAAO,QAAE,GAAA;;GAClB,OAAA,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,CAAA;GAAA,CADD,EAAE,CAAC;EAEhB,OAAA,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,CAAA;EAAA,CAHI;CAIlB,EAAE,CAAC,EAAE,CAAC,KAAK,CAAE,SAAS,CAAA;;OAEhB,UAAM,CAAC,KAAK,CAAC,EAAI,CAAC;;CAExB,OAAA,EAAE,CAAC,YAAY,CAAC,CAAC,CAAE,QAAE,GAAA;;;MAEhB,IAAI,GAAG,IAAI,CAAC,KAAK,EAAE;;EAEvB,EAAE,CAAC,IAAI,CAAC,MAAM,CAAE,CAAC,CAAA;EACjB,OAAA,EAAE,CAAC,YAAY,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,CAAE,QAAE,GAAA;;GAC9B,EAAE,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAA;GACtB,OAAA,EAAE,CAAC,EAAE,CAAC,KAAK,CAAE,CAAC,CAAA;GAAA,CAFa;EAEb,CAPE;CAOF,CArBb;;;;;;;;;;;;;;;;;;AAuBF;"}},"css":{"code":""},"warnings":[],"errors":[]}
{"js":{"code":"function defineName$__(cls,name){\n\tObject.defineProperty(cls,\"name\",{value:name,configurable:true});\n};;\nfunction inheritClass$__(cls){\n\tObject.getPrototypeOf(cls.prototype).constructor?.inherited?.(cls);\n};\nimport {accessor as imba_accessor} from 'imba';\nvar $1 = Symbol('name'), $2 = Symbol(), $3 = Symbol('number'), $4 = Symbol(), $5 = Symbol(), $6 = Symbol('hub'), $7 = Symbol(), $8 = Symbol('name'), $9 = Symbol(), $10 = Symbol('number'), $11 = Symbol(), $12 = Symbol(), $14, $15, $17, $18, $19;\nconst $__init__$ = Symbol.for('#__init__'), $__patch__$ = Symbol.for('#__patch__'), $__initor__$ = Symbol.for('#__initor__'), $__inited__$ = Symbol.for('#__inited__'), $__hooks__$ = Symbol.for('#__hooks__');\n\n/*body*/\nimport setup from './setup';\n\nclass Hub extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $13;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($13 = $$.name) !== undefined && this.ααname.$init($13,this,$1,'name',$$);\n\t\tfields && ($13 = $$.number) !== undefined && this.ααnumber.$init($13,this,$3,'number',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$5 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααname.$init($$ ? $$.name : undefined,this,$1,'name',$$);\n\t\tfields && this.ααnumber.$init($$ ? $$.number : undefined,this,$3,'number',$$);\n\t\t\n\t}\n\tset name(val){ this.ααname.$set(val,this,$1,'name') }\n\tget name(){ return this.ααname.$get(this,$1,'name') }\n\tget ααname(){ return this[$2] || imba_accessor(($14 = this.αstring(),$14),this,$1,'name',$2,Hub.prototype) }\n\tset number(val){ this.ααnumber.$set(val,this,$3,'number') }\n\tget number(){ return this.ααnumber.$get(this,$3,'number') }\n\tget ααnumber(){ return this[$4] || imba_accessor(($15 = this.αint(),$15),this,$3,'number',$4,Hub.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $5;defineName$__(this,'Hub');inheritClass$__(this);}\n};\n\nclass Item extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $16;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($16 = $$.hub) !== undefined && this.ααhub.$init($16,this,$6,'hub',$$);\n\t\tfields && ($16 = $$.name) !== undefined && this.ααname.$init($16,this,$8,'name',$$);\n\t\tfields && ($16 = $$.number) !== undefined && this.ααnumber.$init($16,this,$10,'number',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$12 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααhub.$init($$ ? $$.hub : undefined,this,$6,'hub',$$);\n\t\tfields && this.ααname.$init($$ ? $$.name : undefined,this,$8,'name',$$);\n\t\tfields && this.ααnumber.$init($$ ? $$.number : undefined,this,$10,'number',$$);\n\t\t\n\t}\n\tset hub(val){ this.ααhub.$set(val,this,$6,'hub') }\n\tget hub(){ return this.ααhub.$get(this,$6,'hub') }\n\tget ααhub(){ return this[$7] || imba_accessor(($17 = this.αref(Hub),$17),this,$6,'hub',$7,Item.prototype) }\n\tset name(val){ this.ααname.$set(val,this,$8,'name') }\n\tget name(){ return this.ααname.$get(this,$8,'name') }\n\tget ααname(){ return this[$9] || imba_accessor(($18 = this.αstring(),$18),this,$8,'name',$9,Item.prototype) }\n\tset number(val){ this.ααnumber.$set(val,this,$10,'number') }\n\tget number(){ return this.ααnumber.$get(this,$10,'number') }\n\tget ααnumber(){ return this[$11] || imba_accessor(($19 = this.αint(),$19),this,$10,'number',$11,Item.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $12;defineName$__(this,'Item');inheritClass$__(this);}\n};\n\nawait setup(__filename);\n\ntest(\"build\",async function() {\n\t\n\tlet hub = Hub.build();\n\tok(hub.unsavedΦ);\n\tok(hub.resolvedΦ);\n\tok(!(hub.persistedΦ));\n\tok(!(hub.$cloud));\n\t\n\thub.number = 2;\n\tok(hub.unsavedΦ);\n\tawait hub.save();\n\tok(!(hub.unsavedΦ));\n\tok(hub.persistedΦ);\n\tok(!(!(hub.$cloud)));\n\treturn ok(hub.$cloud == hub.$plain);\n});\n\ntest(\"persisted via database\",function() {\n\t\n\tlet hub = Hub.build();\n\tok(hub.unsavedΦ);\n\tok(hub.resolvedΦ);\n\tok(!(hub.persistedΦ));\n\t\n\t// faking a patch from db\n\tOP.$patch({id: hub.id,_rev: 4,number: 3});\n\tok(hub.number == 3);\n\treturn ok(hub.persistedΦ);\n});\n\ntest(\"initial\",async function() {\n\t\n\tlet hub = await Hub.create();\n\tlet item = Item.build({hub: hub,number: 1});\n\tawait item.save();\n\tok(!(!(OP.$rich[item.id])));\n\tok(item.$cloud.number,1);\n\t\n\tok(item.hub,hub);\n\tok(item.$plain.hub,hub.id);\n\t\n\tok(item.$mutations.length,0);\n\tawait item.update({number: 2});\n\tok(item.$mutations.length,1);\n\tok(item.$cloud.number,2);\n\tok(item.$plain,item.$cloud);\n\treturn ok(item.number,2);\n});\n\ntest(\"refs\",async function() {\n\t\n\tlet hub = await Hub.create();\n\tlet item = await Item.create({hub: hub,number: 3});\n\tok(item.$plain.hub,hub.id);\n\tok(item.$mutations.length,0);\n\t\n\tawait item.update(\n\t\t{hub: null}\n\t);\n\tok(item.hub,undefined);\n\tok(item.$mutations.length,1);\n\treturn ok(item.$plain.hub,'');\n});\n\ntest(\"plain\",async function() {\n\t\n\t\n\tlet item = await Item.create({number: 3});\n\treturn ok(item.number,3);\n});\n","dependencies":[],"map":{"version":3,"file":"update.test.js","sourceRoot":"","sources":["/Users/sindre/repos/scrimba/op/test/update.test.imba"],"sourcesContent":["import setup from './setup'\n\nclass Hub < OP.Object\n\tname @string\n\tnumber @int\n\nclass Item < OP.Object\n\thub @ref(Hub)\n\tname @string\n\tnumber @int\n\nawait setup(__filename)\n\ntest \"build\" do\n\tlet hub = Hub.build()\n\tok hub.unsaved?\n\tok hub.resolved?\n\tok !hub.persisted?\n\tok !hub.$cloud\n\n\thub.number = 2\n\tok hub.unsaved?\n\tawait hub.save!\n\tok !hub.unsaved?\n\tok hub.persisted?\n\tok !!hub.$cloud\n\tok hub.$cloud == hub.$plain\n\ntest \"persisted via database\" do\n\tlet hub = Hub.build()\n\tok hub.unsaved?\n\tok hub.resolved?\n\tok !hub.persisted?\n\n\t# faking a patch from db\n\tOP.$patch({id: hub.id, _rev: 4, number: 3})\n\tok hub.number == 3\n\tok hub.persisted?\n\ntest \"initial\" do\n\tlet hub = await Hub.create!\n\tlet item = Item.build(hub: hub, number: 1)\n\tawait item.save!\n\tok !!OP.$rich[item.id]\n\tok item.$cloud.number, 1\n\n\tok item.hub, hub\n\tok item.$plain.hub, hub.id\n\n\tok item.$mutations.length, 0\n\tawait item.update(number: 2)\n\tok item.$mutations.length, 1\n\tok item.$cloud.number, 2\n\tok item.$plain, item.$cloud\n\tok item.number, 2\n\ntest \"refs\" do\n\tlet hub = await Hub.create!\n\tlet item = await Item.create(hub: hub,number: 3)\n\tok item.$plain.hub, hub.id\n\tok item.$mutations.length, 0\n\n\tawait item.update\n\t\thub: null\n\tok item.hub, undefined\n\tok item.$mutations.length, 1\n\tok item.$plain.hub, ''\n\ntest \"plain\" do\n\n\tlet item = await Item.create(number: 3)\n\tok item.number, 3\n"],"names":[],"mappings":"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"}},"css":{"code":""},"warnings":[],"errors":[]}
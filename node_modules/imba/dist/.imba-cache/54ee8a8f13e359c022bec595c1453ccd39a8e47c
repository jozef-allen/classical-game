{"js":{"code":"function defineName$__(cls,name){\n\tObject.defineProperty(cls,\"name\",{value:name,configurable:true});\n};;\nfunction inheritClass$__(cls){\n\tObject.getPrototypeOf(cls.prototype).constructor?.inherited?.(cls);\n};\nimport {accessor as imba_accessor} from 'imba';\nvar $1 = Symbol('name'), $2 = Symbol(), $3 = Symbol(), $4 = Symbol('name'), $5 = Symbol(), $6 = Symbol('num'), $7 = Symbol(), $8 = Symbol('labels'), $9 = Symbol(), $10 = Symbol('strings'), $11 = Symbol(), $12 = Symbol('parents'), $13 = Symbol(), $14 = Symbol('owners'), $15 = Symbol(), $16 = Symbol(), $18, $20, $21, $22, $23, $24, $25;\nconst $__init__$ = Symbol.for('#__init__'), $__patch__$ = Symbol.for('#__patch__'), $__initor__$ = Symbol.for('#__initor__'), $__inited__$ = Symbol.for('#__inited__'), $__hooks__$ = Symbol.for('#__hooks__');\n\n/*body*/\nimport setup from '../setup';\n\nclass Label extends OPObject {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $17;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($17 = $$.name) !== undefined && this.ααname.$init($17,this,$1,'name',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$3 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααname.$init($$ ? $$.name : undefined,this,$1,'name',$$);\n\t\t\n\t}\n\tset name(val){ this.ααname.$set(val,this,$1,'name') }\n\tget name(){ return this.ααname.$get(this,$1,'name') }\n\tget ααname(){ return this[$2] || imba_accessor(($18 = this.αstring(),$18),this,$1,'name',$2,Label.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $3;defineName$__(this,'Label');inheritClass$__(this);}\n};\n\nclass Item extends OPObject {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $19;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($19 = $$.name) !== undefined && this.ααname.$init($19,this,$4,'name',$$);\n\t\tfields && ($19 = $$.num) !== undefined && this.ααnum.$init($19,this,$6,'num',$$);\n\t\tfields && ($19 = $$.labels) !== undefined && this.ααlabels.$init($19,this,$8,'labels',$$);\n\t\tfields && ($19 = $$.strings) !== undefined && this.ααstrings.$init($19,this,$10,'strings',$$);\n\t\tfields && ($19 = $$.parents) !== undefined && this.ααparents.$init($19,this,$12,'parents',$$);\n\t\tfields && ($19 = $$.owners) !== undefined && this.ααowners.$init($19,this,$14,'owners',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$16 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααname.$init($$ ? $$.name : undefined,this,$4,'name',$$);\n\t\tfields && this.ααnum.$init($$ ? $$.num : undefined,this,$6,'num',$$);\n\t\tfields && this.ααlabels.$init($$ ? $$.labels : undefined,this,$8,'labels',$$);\n\t\tfields && this.ααstrings.$init($$ ? $$.strings : undefined,this,$10,'strings',$$);\n\t\tfields && this.ααparents.$init($$ ? $$.parents : undefined,this,$12,'parents',$$);\n\t\tfields && this.ααowners.$init($$ ? $$.owners : undefined,this,$14,'owners',$$);\n\t\t\n\t}\n\tset name(val){ this.ααname.$set(val,this,$4,'name') }\n\tget name(){ return this.ααname.$get(this,$4,'name') }\n\tget ααname(){ return this[$5] || imba_accessor(($20 = this.αstring(),$20),this,$4,'name',$5,Item.prototype) }\n\tset num(val){ this.ααnum.$set(val,this,$6,'num') }\n\tget num(){ return this.ααnum.$get(this,$6,'num') }\n\tget ααnum(){ return this[$7] || imba_accessor(($21 = this.αnumber(),$21),this,$6,'num',$7,Item.prototype) }\n\tset labels(val){ this.ααlabels.$set(val,this,$8,'labels') }\n\tget labels(){ return this.ααlabels.$get(this,$8,'labels') }\n\tget ααlabels(){ return this[$9] || imba_accessor(($22 = this.αzset(Label),$22),this,$8,'labels',$9,Item.prototype) }\n\tset strings(val){ this.ααstrings.$set(val,this,$10,'strings') }\n\tget strings(){ return this.ααstrings.$get(this,$10,'strings') }\n\tget ααstrings(){ return this[$11] || imba_accessor(($23 = this.αzset(String),$23),this,$10,'strings',$11,Item.prototype) }\n\tset parents(val){ this.ααparents.$set(val,this,$12,'parents') }\n\tget parents(){ return this.ααparents.$get(this,$12,'parents') }\n\tget ααparents(){ return this[$13] || imba_accessor(($24 = this.αparents(Item),$24),this,$12,'parents',$13,Item.prototype) }\n\tset owners(val){ this.ααowners.$set(val,this,$14,'owners') }\n\tget owners(){ return this.ααowners.$get(this,$14,'owners') }\n\tget ααowners(){ return this[$15] || imba_accessor(($25 = this.αzset(OP.User),($25.as instanceof Function) ? $25.as(OP.OWNER) : ($25.as = OP.OWNER),$25),this,$14,'owners',$15,Item.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $16;defineName$__(this,'Item');inheritClass$__(this);}\n};\n\nawait setup(__filename,{data: {}});\n\ntest.only(\"@parents\",async function() {\n\t\n\tlet a = await Item.create();\n\tlet b = await Item.create();\n\tlet c = await Item.create();\n\tconsole.log(\"%s %s\",'\u001b[90m::\u001b[0m','\u001b[40m\u001b[32m\\'here\\'\u001b[0m');\n\tlet d = await Item.create({parents: [a,b]});\n\t\n\tok(a.$children.size,1);\n\tok(b.$children.size,1);\n\t\n\t// add c\n\tc.parents.add(b);\n\tok(b.$children.size,2);\n\tok(c.unsavedΦ);\n\t// reset -- see that it is removed again\n\tc.$reset();\n\tok(b.$children.size,1);\n\t\n\tc.parents.add(a);\n\tawait c.save();\n\treturn ok(a.$children.size,2);\n});\n\ntest(\"@zset.as\",async function({sindre: sindre,per: per,magnus: magnus}) {\n\t\n\tlet a = await Item.create({owners: [sindre,per]});\n\tok([...a.owners],[sindre,per]);\n\tok(a.rolesΞfor(sindre) & OP.OWNER);\n\tok((a.rolesΞfor(magnus) & OP.OWNER)==0);\n\t\n\tlet r = await a.save();\n\t// no!\n\t\n\ta.owners.move(per,{before: sindre});\n\tok([...a.owners],[per,sindre]);\n\tawait a.reset();\n\tok([...a.owners],[sindre,per]);\n\treturn await a.save();\n});\n\ntest(\"strings\",async function() {\n\t\n\tlet s = await Item.create();\n\tok(s.strings.size,0);\n\t\n\tawait s.$setraw({\"strings.one\": 100});\n\tok(s.$cloud.strings.one,100);\n\tok([...s.strings],[\"one\"]);\n\t\n\tawait s.$setraw({\"strings.two\": 150});\n\tok([...s.strings],[\"one\",\"two\"]);\n\t\n\t// Add third in between\n\tawait s.$setraw({\"strings.three\": 125});\n\tok([...s.strings],[\"one\",\"three\",\"two\"]);\n\t\n\t// Move middle to last\n\tawait s.$setraw({\"strings.three\": 175});\n\tok([...s.strings],[\"one\",\"two\",\"three\"]);\n\t\n\t// Remove first\n\tawait s.$setraw({\"strings.one\": null});\n\tok([...s.strings],[\"two\",\"three\"]);\n\t\n\t// Now manually do one of them\n\ts.strings.delete(\"two\");\n\tok(s.unsavedΦ);\n\t\n\tawait s.save();\n\tok(!(s.unsavedΦ));\n\tok([...s.strings],[\"three\"]);\n\t\n\t// Now add some of them again\n\tawait s.$setraw({\"strings.two\": 275,\"strings.one\": 100});\n\tok([...s.strings],[\"one\",\"three\",\"two\"]);\n\t\n\t// Fully replacing from server\n\tawait s.$setraw({strings: {four: 275}});\n\treturn ok([...s.strings],[\"four\"]);\n});\n\n","dependencies":[],"map":{"version":3,"file":"zset.test.js","sourceRoot":"","sources":["/Users/sindre/repos/scrimba/op/test/fields/zset.test.imba"],"sourcesContent":["import setup from '../setup'\n\nclass Label < OPObject\n\tname @string\n\nclass Item < OPObject\n\tname @string\n\tnum @number\n\tlabels @zset(Label)\n\tstrings @zset(String)\n\tparents @parents(Item)\n\towners @zset(OP.User).as(OP.OWNER)\n\nawait setup(__filename, data: {})\n\ntest.only \"@parents\" do\n\tlet a = await Item.create!\n\tlet b = await Item.create!\n\tlet c = await Item.create!\n\tL 'here'\n\tlet d = await Item.create(parents: [a,b])\n\t\n\tok a.$children.size,1\n\tok b.$children.size,1\n\n\t# add c\n\tc.parents.add(b)\n\tok b.$children.size,2\n\tok c.unsaved?\n\t# reset -- see that it is removed again\n\tc.$reset!\n\tok b.$children.size,1\n\n\tc.parents.add(a)\n\tawait c.save!\n\tok a.$children.size,2\n\ntest \"@zset.as\" do({sindre,per,magnus})\n\tlet a = await Item.create(owners: [sindre,per])\n\tok [...a.owners],[sindre,per]\n\tok a.roles-for(sindre) & OP.OWNER\n\tok a.roles-for(magnus) !& OP.OWNER\n\n\tlet r = await a.save!\n\t# no!\n\n\ta.owners.move(per,before: sindre)\n\tok [...a.owners],[per,sindre]\n\tawait a.reset!\n\tok [...a.owners],[sindre,per]\n\tawait a.save!\n\ntest \"strings\" do\n\tlet s = await Item.create!\n\tok s.strings.size,0\n\n\tawait s.$setraw( \"strings.one\": 100)\n\tok s.$cloud.strings.one,100\n\tok [...s.strings],[\"one\"]\n\n\tawait s.$setraw( \"strings.two\": 150)\n\tok [...s.strings],[\"one\",\"two\"]\n\n\t# Add third in between\n\tawait s.$setraw( \"strings.three\": 125 )\n\tok [...s.strings],[\"one\",\"three\",\"two\"]\n\n\t# Move middle to last\n\tawait s.$setraw( \"strings.three\": 175 )\n\tok [...s.strings],[\"one\",\"two\",\"three\"]\n\n\t# Remove first\n\tawait s.$setraw( \"strings.one\": null )\n\tok [...s.strings],[\"two\",\"three\"]\n\n\t# Now manually do one of them\n\ts.strings.delete(\"two\")\n\tok s.unsaved?\n\n\tawait s.save!\n\tok !s.unsaved?\n\tok [...s.strings],[\"three\"]\n\n\t# Now add some of them again\n\tawait s.$setraw( \"strings.two\": 275, \"strings.one\": 100 )\n\tok [...s.strings],[\"one\",\"three\",\"two\"]\n\n\t# Fully replacing from server\n\tawait s.$setraw( strings: {four: 275})\n\tok [...s.strings],[\"four\"]\n\n"],"names":[],"mappings":"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"}},"css":{"code":""},"warnings":[],"errors":[]}
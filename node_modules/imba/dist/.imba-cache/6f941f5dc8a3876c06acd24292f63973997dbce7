{"js":{"code":"\n/*body*/\nimport setup from '../setup';\nimport data from './schema';\n\nawait setup(__filename,{data: data});\n\nOP.pub(OP.Hub,function(sub,hub) {\n\t\n\treturn sub.add(hub,sub.ALL);\n});\n\nOP.pub(OP.Scrim,function(sub,item) {\n\t\n\treturn sub.add(item,sub.ALL | sub.FULL);\n});\n\ndescribe(\"publications\",function() {\n\t\n\ttest(\"respect private\",async function({h01: h01,u02: u02,u05: u05,c02: c02,s022: s022}) {\n\t\t\n\t\tawait u02.run(async function() {\n\t\t\t\n\t\t\tlet sub = await OP.sub(h01);\n\t\t\tok(sub.has(c02));\n\t\t\treturn ok(sub.has(s022));\n\t\t});\n\t\t\n\t\tawait u05.run(async function() {\n\t\t\t\n\t\t\t// c02 is private, so s05 won't have access to it\n\t\t\tlet sub = await OP.sub(h01);\n\t\t\tok(!(sub.has(c02)));\n\t\t\treturn ok(!(sub.has(s022)));\n\t\t});\n\t\t\n\t\t// update privacy\n\t\tawait c02.update({private: false});\n\t\t\n\t\treturn await u05.run(async function() {\n\t\t\t\n\t\t\t// now that it is public we have access again\n\t\t\tlet sub = await OP.sub(h01);\n\t\t\tok(sub.has(c02));\n\t\t\treturn ok(sub.has(s022));\n\t\t});\n\t});\n\t\n\treturn test(\"lazy fields\",async function({h01: h01,u02: u02,u05: u05,c02: c02,s011: s011,s022: s022}) {\n\t\t\n\t\tawait u02.run(async function() {\n\t\t\t\n\t\t\tlet sub = await OP.sub(h01);\n\t\t\tok((sub.get('s011')._ & OPFLAGS.FULL)==0);\n\t\t\treturn ok(sub.get('s021')._ & OPFLAGS.FULL);\n\t\t});\n\t\t\n\t\treturn await u02.run(async function() {\n\t\t\t\n\t\t\tlet sub = await OP.sub(s011);\n\t\t\treturn ok(sub.get('s011')._ & OPFLAGS.FULL);\n\t\t});\n\t});\n});\n","dependencies":[],"map":{"version":3,"file":"pub.test.js","sourceRoot":"","sources":["/Users/sindre/repos/scrimba/op/test/courses/pub.test.imba"],"sourcesContent":["import setup from '../setup'\nimport data from './schema'\n\nawait setup(__filename, data: data)\n\nOP.pub(OP.Hub) do(sub,hub)\n\tsub.add(hub,sub.ALL)\n\nOP.pub(OP.Scrim) do(sub,item)\n\tsub.add(item,sub.ALL | sub.FULL)\n\ndescribe \"publications\" do\n\ttest \"respect private\" do({h01,u02,u05,c02,s022})\n\t\tawait u02.run do\n\t\t\tlet sub = await OP.sub(h01)\n\t\t\tok sub.has(c02)\n\t\t\tok sub.has(s022)\n\n\t\tawait u05.run do\n\t\t\t# c02 is private, so s05 won't have access to it\n\t\t\tlet sub = await OP.sub(h01)\n\t\t\tok !sub.has(c02)\n\t\t\tok !sub.has(s022)\n\n\t\t# update privacy\n\t\tawait c02.update(private: no)\n\n\t\tawait u05.run do\n\t\t\t# now that it is public we have access again\n\t\t\tlet sub = await OP.sub(h01)\n\t\t\tok sub.has(c02)\n\t\t\tok sub.has(s022)\n\n\ttest \"lazy fields\" do({h01,u02,u05,c02,s011,s022})\n\t\tawait u02.run do\n\t\t\tlet sub = await OP.sub(h01)\n\t\t\tok sub.get('s011')._ !& OPFLAGS.FULL\n\t\t\tok sub.get('s021')._ & OPFLAGS.FULL\n\n\t\tawait u02.run do\n\t\t\tlet sub = await OP.sub(s011)\n\t\t\tok sub.get('s011')._ & OPFLAGS.FULL\n"],"names":[],"mappings":";;AAAA,MAAM,CAAC,KAAK,MAAM,UAAU;AAC5B,MAAM,CAAC,IAAI,MAAM,UAAU;;MAErB,KAAK,CAAC,UAAU,EAAE,IAAI,EAAE,IAAI,EAAC;;AAEnC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAE,QAAE,CAAC,GAAG,CAAC,GAAG,EAAC;;CACzB,OAAA,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC;CAAA,CADP;;AAGd,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,KAAK,CAAE,QAAE,CAAC,GAAG,CAAC,IAAI,EAAC;;CAC5B,OAAA,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC;CAAA,CADjB;;AAGhB,QAAQ,CAAC,cAAc,CAAC,QAAE,GAAA;;CACzB,IAAI,CAAC,iBAAiB,CAAC,cAAE,CAAC,CAAC,GAAG,EAAH,GAAG,CAAC,GAAG,EAAH,GAAG,CAAC,GAAG,EAAH,GAAG,CAAC,GAAG,EAAH,GAAG,CAAC,IAAI,EAAJ,IAAI,CAAC,EAAC;;QAC1C,GAAG,CAAC,GAAG,CAAC,cAAE,GAAA;;OACX,GAAG,SAAS,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC;GAC3B,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;GACf,OAAA,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;GAAA,CAHJ;;QAKP,GAAG,CAAC,GAAG,CAAC,cAAE,GAAA;;;OAEX,GAAG,SAAS,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC;GAC3B,EAAE,CAAC,EAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA,CAAA;GAChB,OAAA,EAAE,CAAC,EAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA,CAAA;GAAA,CAJL;;;QAOP,GAAG,CAAC,MAAM,EAAC,OAAO,EAAE,KAAE,EAAC;;eAEvB,GAAG,CAAC,GAAG,CAAC,cAAE,GAAA;;;OAEX,GAAG,SAAS,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC;GAC3B,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;GACf,OAAA,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;GAAA,CAJJ;EAII,CAnBd;;CAqBJ,OAAA,IAAI,CAAC,aAAa,CAAC,cAAE,CAAC,CAAC,GAAG,EAAH,GAAG,CAAC,GAAG,EAAH,GAAG,CAAC,GAAG,EAAH,GAAG,CAAC,GAAG,EAAH,GAAG,CAAC,IAAI,EAAJ,IAAI,CAAC,IAAI,EAAJ,IAAI,CAAC,EAAC;;QAC3C,GAAG,CAAC,GAAG,CAAC,cAAE,GAAA;;OACX,GAAG,SAAS,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC;GAC3B,EAAE,CAAC,CAAA,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAE,CAAC,OAAO,CAAC,IAAI,IAAA,CAAA;GACpC,OAAA,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAA;GAAA,CAHvB;;eAKP,GAAG,CAAC,GAAG,CAAC,cAAE,GAAA;;OACX,GAAG,SAAS,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC;GAC5B,OAAA,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAA;GAAA,CAFvB;EAEuB,CARjC;CAQiC,CA9B9B;AA+BR;"}},"css":{"code":""},"warnings":[],"errors":[]}
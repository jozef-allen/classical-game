{"js":{"code":"function defineName$__(cls,name){\n\tObject.defineProperty(cls,\"name\",{value:name,configurable:true});\n};;\nfunction inheritClass$__(cls){\n\tObject.getPrototypeOf(cls.prototype).constructor?.inherited?.(cls);\n};\nimport {accessor as imba_accessor} from 'imba';\nvar $1 = Symbol('id'), $2 = Symbol(), $3 = Symbol('creator'), $4 = Symbol(), $5 = Symbol('users'), $6 = Symbol(), $7 = Symbol('strings'), $8 = Symbol(), $9 = Symbol('name'), $10 = Symbol(), $11 = Symbol('desc'), $12 = Symbol(), $13 = Symbol(), $15, $16, $17, $18, $19, $20;\nconst $__init__$ = Symbol.for('#__init__'), $__patch__$ = Symbol.for('#__patch__'), $__initor__$ = Symbol.for('#__initor__'), $__inited__$ = Symbol.for('#__inited__'), $__hooks__$ = Symbol.for('#__hooks__');\n\n/*body*/\nimport setup from './setup';\n\nexport class Item extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $14;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($14 = $$.id) !== undefined && this.ααid.$init($14,this,$1,'id',$$);\n\t\tfields && ($14 = $$.creator) !== undefined && this.ααcreator.$init($14,this,$3,'creator',$$);\n\t\tfields && ($14 = $$.users) !== undefined && this.ααusers.$init($14,this,$5,'users',$$);\n\t\tfields && ($14 = $$.strings) !== undefined && this.ααstrings.$init($14,this,$7,'strings',$$);\n\t\tfields && ($14 = $$.name) !== undefined && this.ααname.$init($14,this,$9,'name',$$);\n\t\tfields && ($14 = $$.desc) !== undefined && this.ααdesc.$init($14,this,$11,'desc',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$13 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααid.$init($$ ? $$.id : undefined,this,$1,'id',$$);\n\t\tfields && this.ααcreator.$init($$ ? $$.creator : undefined,this,$3,'creator',$$);\n\t\tfields && this.ααusers.$init($$ ? $$.users : undefined,this,$5,'users',$$);\n\t\tfields && this.ααstrings.$init($$ ? $$.strings : undefined,this,$7,'strings',$$);\n\t\tfields && this.ααname.$init($$ ? $$.name : undefined,this,$9,'name',$$);\n\t\tfields && this.ααdesc.$init($$ ? $$.desc : undefined,this,$11,'desc',$$);\n\t\t\n\t}\n\tset id(val){ this.ααid.$set(val,this,$1,'id') }\n\tget id(){ return this.ααid.$get(this,$1,'id') }\n\tget ααid(){ return this[$2] || imba_accessor(($15 = this.αkey(),$15),this,$1,'id',$2,Item.prototype) }\n\tset creator(val){ this.ααcreator.$set(val,this,$3,'creator') }\n\tget creator(){ return this.ααcreator.$get(this,$3,'creator') }\n\tget ααcreator(){ return this[$4] || imba_accessor(($16 = this.αref(OP.User),($16.as instanceof Function) ? $16.as(OP.OWNER) : ($16.as = OP.OWNER),$16.default = function() {\n\t\treturn OP.user;\n\t},$16),this,$3,'creator',$4,Item.prototype) }\n\tset users(val){ this.ααusers.$set(val,this,$5,'users') }\n\tget users(){ return this.ααusers.$get(this,$5,'users') }\n\tget ααusers(){ return this[$6] || imba_accessor(($17 = this.αzset(OP.User),($17.as instanceof Function) ? $17.as(OP.MEMBER) : ($17.as = OP.MEMBER),$17),this,$5,'users',$6,Item.prototype) }\n\tset strings(val){ this.ααstrings.$set(val,this,$7,'strings') }\n\tget strings(){ return this.ααstrings.$get(this,$7,'strings') }\n\tget ααstrings(){ return this[$8] || imba_accessor(($18 = this.αzset(String),$18),this,$7,'strings',$8,Item.prototype) }\n\tset name(val){ this.ααname.$set(val,this,$9,'name') }\n\tget name(){ return this.ααname.$get(this,$9,'name') }\n\tget ααname(){ return this[$10] || imba_accessor(($19 = this.αstring(),$19),this,$9,'name',$10,Item.prototype) }\n\tset desc(val){ this.ααdesc.$set(val,this,$11,'desc') }\n\tget desc(){ return this.ααdesc.$get(this,$11,'desc') }\n\tget ααdesc(){ return this[$12] || imba_accessor(($20 = this.αstring(),$20),this,$11,'desc',$12,Item.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $13;defineName$__(this,'Item');inheritClass$__(this);}\n};\n\nawait setup(__filename,{preload: true,data: {\n\tU01: {name: 'Sindre'},\n\tU02: {name: 'Mikey'},\n\tU03: {name: 'Frode'},\n\tU04: {name: 'Abdellah'},\n\titem01: {name: 'Item',creator: 'U01',users: {U01: 10,U02: 20}}\n}});\n\ntest(\"loading immediately\",function({item01: item01,U01: U01,U02: U02}) {\n\t\n\tlet zset = item01.users;\n\tok(zset.size,2);\n\treturn ok([...zset],[U01,U02]);\n});\n\ntest(\"patching\",async function({U03: U03}) {\n\t\n\tlet item = await Item.create();\n\tok(item.users.size,0);\n\tlet upd = await OP.db.update(item.id,{users: {U04: 100}});\n\titem.users.add(U03);\n\titem.$patch(upd);\n\t\n\tok(item.users.size,2);\n\tawait item.persist();\n\treturn ok(!(item.users.unsavedΦ));\n});\n\ntest(\"Creating\",async function({U01: U01,U02: U02}) {\n\t\n\tlet item = await Item.create({users: [U01,U02]});\n\tok(item.users.size,2);\n\treturn ok([...item.users],[U01,U02]);\n});\n\ntest(\"Removing\",async function({U01: U01,U02: U02}) {\n\t\n\tlet item = await Item.create({users: [U01,U02]});\n\tok(item.users.size,2);\n\tok([...item.users],[U01,U02]);\n\titem.users.delete(U02);\n\tok([...item.users],[U01]);\n\t// reset the changes without applying\n\treturn await item.persist();\n\t\n\t// item.users.$reset!\n\t// ok [...item.users],[o.U01,o.U02]\n});\n\ntest(\"reading null\",async function() {\n\t\n\tlet item = OP.$patch(await OP.db.insert('item02',{users: {U01: null,U02: 20}}));\n\treturn ok(item.users.size,1);\n});\n\ntest(\"building\",async function({U01: U01,U02: U02}) {\n\t\n\tlet item = Item.build();\n\titem.users.add(U01);\n\titem.users.add(U01);// second time\n\tawait item.$muts.persist();\n\tawait item.save();\n\tok(item.$cloud.users.U01);\n\treturn ok([...item.users],[U01]);\n});\n\ntest(\"with strings\",async function() {\n\t\n\tlet item = await Item.create();\n\tok(item.savedΦ);\n\titem.strings.add(\"one\");\n\titem.strings.add(\"two\");\n\titem.strings.add(\"M0.2134\");\n\treturn await item.save();\n});\n","dependencies":[],"map":{"version":3,"file":"zset.test.js","sourceRoot":"","sources":["/Users/sindre/repos/scrimba/op/test/zset.test.imba"],"sourcesContent":["import setup from './setup'\n\nexport class Item < OP.Object\n\tid @key\n\tcreator @ref(OP.User).as(OP.OWNER) = OP.user\n\tusers @zset(OP.User).as(OP.MEMBER)\n\tstrings @zset(String)\n\tname @string\n\tdesc @string\n\nawait setup(__filename, preload: yes, data: {\n\tU01: {name: 'Sindre'}\n\tU02: {name: 'Mikey'}\n\tU03: {name: 'Frode'}\n\tU04: {name: 'Abdellah'}\n\titem01: {name: 'Item', creator: 'U01', users: {U01: 10, U02: 20}}\n})\n\ntest \"loading immediately\" do({item01,U01,U02})\n\tlet zset = item01.users\n\tok zset.size,2\n\tok [...zset],[U01,U02]\n\ntest \"patching\" do({U03})\n\tlet item = await Item.create!\n\tok item.users.size,0\n\tlet upd = await OP.db.update(item.id,{users: {U04: 100}})\n\titem.users.add(U03)\n\titem.$patch(upd)\n\n\tok item.users.size,2\n\tawait item.persist!\n\tok !item.users.unsaved?\n\ntest \"Creating\" do({U01,U02})\n\tlet item = await Item.create(users: [U01,U02])\n\tok item.users.size,2\n\tok [...item.users],[U01,U02]\n\ntest \"Removing\" do({U01,U02})\n\tlet item = await Item.create(users: [U01,U02])\n\tok item.users.size,2\n\tok [...item.users],[U01,U02]\n\titem.users.delete(U02)\n\tok [...item.users],[U01]\n\t# reset the changes without applying\n\tawait item.persist!\n\n\t# item.users.$reset!\n\t# ok [...item.users],[o.U01,o.U02]\n\ntest \"reading null\" do\n\tlet item = OP.$patch await OP.db.insert('item02',{users: {U01: null, U02: 20}})\n\tok item.users.size,1\n\ntest \"building\" do({U01,U02})\n\tlet item = Item.build()\n\titem.users.add U01\n\titem.users.add U01 # second time\n\tawait item.$muts.persist!\n\tawait item.save!\n\tok item.$cloud.users.U01\n\tok [...item.users],[U01]\n\ntest \"with strings\" do\n\tlet item = await Item.create!\n\tok item.saved?\n\titem.strings.add(\"one\")\n\titem.strings.add(\"two\")\n\titem.strings.add(\"M0.2134\")\n\tawait item.save!"],"names":[],"mappings":"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"}},"css":{"code":""},"warnings":[],"errors":[]}
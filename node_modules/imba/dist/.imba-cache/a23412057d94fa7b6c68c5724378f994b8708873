{"js":{"code":"function defineName$__(cls,name){\n\tObject.defineProperty(cls,\"name\",{value:name,configurable:true});\n};;\nfunction inheritClass$__(cls){\n\tObject.getPrototypeOf(cls.prototype).constructor?.inherited?.(cls);\n};\nimport {accessor as imba_accessor} from 'imba';\nvar $1 = Symbol('number'), $2 = Symbol(), $3 = Symbol(), $5;\nconst $__init__$ = Symbol.for('#__init__'), $__patch__$ = Symbol.for('#__patch__'), $__initor__$ = Symbol.for('#__initor__'), $__inited__$ = Symbol.for('#__inited__'), $__hooks__$ = Symbol.for('#__hooks__');\n\n/*body*/\nimport setup from '../setup';\n\nclass Item extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $4;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($4 = $$.number) !== undefined && this.ααnumber.$init($4,this,$1,'number',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$3 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααnumber.$init($$ ? $$.number : undefined,this,$1,'number',$$);\n\t\t\n\t}\n\tset number(val){ this.ααnumber.$set(val,this,$1,'number') }\n\tget number(){ return this.ααnumber.$get(this,$1,'number') }\n\tget ααnumber(){ return this[$2] || imba_accessor(($5 = this.αint(),$5),this,$1,'number',$2,Item.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $3;defineName$__(this,'Item');inheritClass$__(this);}\n};\n\nawait setup(__filename);\n\nawait OP.wal;\n\ntest.node(\"initial\",async function() {\n\tvar $6, $7, $8, $9;\n\t\n\tlet n = 10;\n\tlet result;\n\tlet results;\n\t\n\tresults = await Promise.all((function() {\n\t\t$6 = [];\n\t\tfor (let len = n, x = 0, rd = len - x; (rd > 0) ? (x <= len) : (x >= len); (rd > 0) ? (x++) : (x--)) {\n\t\t\t$6.push(OP.wal.waitfor('item01'));\n\t\t};\n\t\treturn $6;\n\t})());\n\tok(results,((function() {\n\t\t$7 = [];\n\t\tfor (let len = n, x = 0, rd = len - x; (rd > 0) ? (x <= len) : (x >= len); (rd > 0) ? (x++) : (x--)) {\n\t\t\t$7.push(false);\n\t\t};\n\t\treturn $7;\n\t})()));\n\t\n\tlet item = OP.get('item01');\n\tok(item.rev,undefined);\n\tok(item.number,undefined);\n\t\n\tawait item;\n\tok(item.rev <= -1);\n\tok(item.number,undefined);\n\t\n\tlet raw = {id: 'item01',number: 4};\n\tlet event = OP.wal.waitfor('item01');\n\tawait OP.sql`insert into _item ${raw}`;\n\t\n\tok((await event),true);\n\tok(item.number,4);\n\t\n\tresults = await Promise.all((function() {\n\t\t$8 = [];\n\t\tfor (let len = n, x = 0, rd = len - x; (rd > 0) ? (x <= len) : (x >= len); (rd > 0) ? (x++) : (x--)) {\n\t\t\t$8.push(OP.wal.waitfor('item01'));\n\t\t};\n\t\treturn $8;\n\t})());\n\tok(results,((function() {\n\t\t$9 = [];\n\t\tfor (let len = n, x = 0, rd = len - x; (rd > 0) ? (x <= len) : (x >= len); (rd > 0) ? (x++) : (x--)) {\n\t\t\t$9.push(false);\n\t\t};\n\t\treturn $9;\n\t})()));\n\t\n\tevent = OP.wal.waitfor('item01');\n\tawait OP.sql`update ${Item} set ${{number: 5}} where id = ${item.id}`;\n\tawait event;\n\treturn ok(item.number,5);\n});\n","dependencies":[],"map":{"version":3,"file":"wal.test.js","sourceRoot":"","sources":["/Users/sindre/repos/scrimba/op/test/misc/wal.test.imba"],"sourcesContent":["import setup from '../setup'\n\nclass Item < OP.Object\n\tnumber @int\n\nawait setup(__filename)\n\nawait OP.wal\n\ntest.node \"initial\" do\n\tlet n = 10\n\tlet result\n\tlet results\n\n\tresults = await Promise.all(OP.wal.waitfor('item01') for x in [0 .. n])\n\tok results, (no for x in [0 .. n])\n\n\tlet item = OP.get 'item01'\n\tok item.rev, undefined\n\tok item.number, undefined\n\n\tawait item\n\tok item.rev <= -1\n\tok item.number, undefined\n\n\tlet raw = {id: 'item01', number: 4}\n\tlet event = OP.wal.waitfor('item01')\n\tawait OP.sql`insert into _item {raw}`\n\n\tok (await event), yes\n\tok item.number, 4\n\n\tresults = await Promise.all(OP.wal.waitfor('item01') for x in [0 .. n])\n\tok results, (no for x in [0 .. n])\n\n\tevent = OP.wal.waitfor('item01')\n\tawait OP.sql`update {Item} set {number:5} where id = {item.id}`\n\tawait event\n\tok item.number, 5\n"],"names":[],"mappings":";;;;;;;;;;;AAAA,MAAM,CAAC,KAAK,MAAM,UAAU;;AAE5B,KAAK,CAAC,IAAI,SAAG,EAAE,CAAC,MAAM,EAAA;qCAFtB;;;qBAGC,MAAM,CAAA;;EAHP;cAAA;;;EAAA;kDAAA;;wCAGC,MAAM;;EAHP;KAGC,MAAM;KAAN,MAAM;KAAN,QAAM,gDAAC,IAAI,EAAA,yBADN,IAAI;;;AACE,CAAA;;MAEN,KAAK,CAAC,UAAU,CAAC;;MAEjB,EAAE,CAAC,GAAG;;AAEZ,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,cAAE,GAAA;;;KACjB,CAAC,GAAG,EAAE;KACN,MAAM;KACN,OAAO;;CAEX,OAAO,SAAS,OAAO,CAAC,GAAG,aAd5B;;EAcsD,GAAG,YAAY,CAAC,MAAN,CAAC,8EAdjE;WAc6B,EAAE,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC;GAdrD;;EAAA,IAcwE;CACvE,EAAE,CAAC,OAAO,cAfX;;EAeiB,GAAG,YAAY,CAAC,MAAN,CAAC,8EAf5B;WAec,KAAE;GAfhB;;EAAA,KAeG;;KAEE,IAAI,GAAG,EAAE,CAAC,GAAG,CAAC,QAAQ,CAAA;CAC1B,EAAE,CAAC,IAAI,CAAC,GAAG,CAAE,SAAS,CAAA;CACtB,EAAE,CAAC,IAAI,CAAC,MAAM,CAAE,SAAS,CAAA;;OAEnB,IAAI;CACV,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAA;CACjB,EAAE,CAAC,IAAI,CAAC,MAAM,CAAE,SAAS,CAAA;;KAErB,GAAG,GAAG,CAAC,EAAE,EAAE,QAAQ,CAAE,MAAM,EAAE,CAAC,CAAC;KAC/B,KAAK,GAAG,EAAE,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC;OAC9B,EAAE,CAAC,GAAG,qBAAoB,GAAG,EAAE;;CAErC,EAAE,QAAQ,KAAK,EAAG,IAAG,CAAA;CACrB,EAAE,CAAC,IAAI,CAAC,MAAM,CAAE,CAAC,CAAA;;CAEjB,OAAO,SAAS,OAAO,CAAC,GAAG,aAhC5B;;EAgCsD,GAAG,YAAY,CAAC,MAAN,CAAC,8EAhCjE;WAgC6B,EAAE,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC;GAhCrD;;EAAA,IAgCwE;CACvE,EAAE,CAAC,OAAO,cAjCX;;EAiCiB,GAAG,YAAY,CAAC,MAAN,CAAC,8EAjC5B;WAiCc,KAAE;GAjChB;;EAAA,KAiCG;;CAEF,KAAK,GAAG,EAAE,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC;OAC1B,EAAE,CAAC,GAAG,UAAS,IAAI,SAAO,MAAM,EAAC,CAAC,gBAAc,IAAI,CAAC,EAAE,EAAE;OACzD,KAAK;CACX,OAAA,EAAE,CAAC,IAAI,CAAC,MAAM,CAAE,CAAC,CAAA;CAAA,CA7BT;AA8BT;"}},"css":{"code":""},"warnings":[],"errors":[]}
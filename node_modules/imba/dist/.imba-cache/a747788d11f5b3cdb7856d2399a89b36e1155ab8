{"js":{"code":"function defineName$__(cls,name){\n\tObject.defineProperty(cls,\"name\",{value:name,configurable:true});\n};;\nfunction inheritClass$__(cls){\n\tObject.getPrototypeOf(cls.prototype).constructor?.inherited?.(cls);\n};\nimport {accessor as imba_accessor} from 'imba';\nvar $1 = Symbol('name'), $2 = Symbol(), $3 = Symbol('num'), $4 = Symbol(), $5 = Symbol('desc'), $6 = Symbol(), $7 = Symbol('arr'), $8 = Symbol(), $9 = Symbol('obj'), $10 = Symbol(), $11 = Symbol(), $13, $14, $15, $16, $17;\nconst $__init__$ = Symbol.for('#__init__'), $__patch__$ = Symbol.for('#__patch__'), $__initor__$ = Symbol.for('#__initor__'), $__inited__$ = Symbol.for('#__inited__'), $__hooks__$ = Symbol.for('#__hooks__');\n\n/*body*/\nimport setup from '../setup';\n\nclass Item extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $12;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($12 = $$.name) !== undefined && this.ααname.$init($12,this,$1,'name',$$);\n\t\tfields && ($12 = $$.num) !== undefined && this.ααnum.$init($12,this,$3,'num',$$);\n\t\tfields && ($12 = $$.desc) !== undefined && this.ααdesc.$init($12,this,$5,'desc',$$);\n\t\tfields && ($12 = $$.arr) !== undefined && this.ααarr.$init($12,this,$7,'arr',$$);\n\t\tfields && ($12 = $$.obj) !== undefined && this.ααobj.$init($12,this,$9,'obj',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$11 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααname.$init($$ ? $$.name : undefined,this,$1,'name',$$);\n\t\tfields && this.ααnum.$init($$ ? $$.num : undefined,this,$3,'num',$$);\n\t\tfields && this.ααdesc.$init($$ ? $$.desc : undefined,this,$5,'desc',$$);\n\t\tfields && this.ααarr.$init($$ ? $$.arr : undefined,this,$7,'arr',$$);\n\t\tfields && this.ααobj.$init($$ ? $$.obj : undefined,this,$9,'obj',$$);\n\t\t\n\t}\n\tset name(val){ this.ααname.$set(val,this,$1,'name') }\n\tget name(){ return this.ααname.$get(this,$1,'name') }\n\tget ααname(){ return this[$2] || imba_accessor(($13 = this.αstring(),$13),this,$1,'name',$2,Item.prototype) }\n\tset num(val){ this.ααnum.$set(val,this,$3,'num') }\n\tget num(){ return this.ααnum.$get(this,$3,'num') }\n\tget ααnum(){ return this[$4] || imba_accessor(($14 = this.αnumber(),$14),this,$3,'num',$4,Item.prototype) }\n\tset desc(val){ this.ααdesc.$set(val,this,$5,'desc') }\n\tget desc(){ return this.ααdesc.$get(this,$5,'desc') }\n\tget ααdesc(){ return this[$6] || imba_accessor(($15 = this.αstring(),$15),this,$5,'desc',$6,Item.prototype) }\n\tset arr(val){ this.ααarr.$set(val,this,$7,'arr') }\n\tget arr(){ return this.ααarr.$get(this,$7,'arr') }\n\tget ααarr(){ return this[$8] || imba_accessor(($16 = this.αjson(),$16),this,$7,'arr',$8,Item.prototype) }\n\tset obj(val){ this.ααobj.$set(val,this,$9,'obj') }\n\tget obj(){ return this.ααobj.$get(this,$9,'obj') }\n\tget ααobj(){ return this[$10] || imba_accessor(($17 = this.αjson(),$17),this,$9,'obj',$10,Item.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $11;defineName$__(this,'Item');inheritClass$__(this);}\n};\n\nawait setup(__filename,{data: {\n\titem01: {name: 'Item'}\n}});\n\ntest(\"insert\",async function() {\n\t\n\t\n\tlet obj = {\n\t\tname: \"a\",\n\t\tobj: {a: 1}\n\t};\n\t\n\treturn await OP.db.insert('item02',obj);\n});\n\ntest(\"update nested\",async function() {\n\t\n\t\n\tlet res = await OP.db.update('item01',{\n\t\t\"obj.test\": 1,\n\t\t\"obj.other\": 2\n\t});\n\t\n\tok(res.obj.test,1);\n\treturn ok(res.obj.other,2);\n});\n\ntest(\"increment\",async function() {\n\t\n\tlet res = await OP.db.update('item01',{\n\t\tnum: {$incr: 5}\n\t});\n\t\n\treturn ok(res.num,5);\n});\n\ntest(\"$push\",async function() {\n\t\n\tlet res = await OP.db.update('item01',{arr: {$push: 'a'}});\n\tok(res.arr,['a']);\n\t\n\tres = await OP.db.update('item01',{arr: {$push: 'b'}});\n\tok(res.arr,['a','b']);\n\t\n\tres = await OP.db.update('item01',{arr: {$delete: 'a'}});\n\treturn ok(res.arr,['b']);\n});\n","dependencies":[],"map":{"version":3,"file":"db.test.js","sourceRoot":"","sources":["/Users/sindre/repos/scrimba/op/test/core/db.test.imba"],"sourcesContent":["import setup from '../setup'\n\nclass Item < OP.Object\n\tname @string\n\tnum @number\n\tdesc @string\n\tarr @json\n\tobj @json\n\nawait setup(__filename, data: {\n\titem01: {name: 'Item'}\n})\n\ntest \"insert\" do\n\n\tlet obj = {\n\t\tname: \"a\"\n\t\tobj: {a: 1}\n\t}\n\n\tawait OP.db.insert('item02',obj)\n\ntest \"update nested\" do\n\n\tlet res = await OP.db.update('item01',{\n\t\t\"obj.test\":1\n\t\t\"obj.other\": 2\n\t})\n\n\tok res.obj.test,1\n\tok res.obj.other,2\n\ntest \"increment\" do\n\tlet res = await OP.db.update('item01',{\n\t\tnum: {$incr: 5}\n\t})\n\n\tok res.num,5\n\ntest \"$push\" do\n\tlet res = await OP.db.update('item01',arr: {$push: 'a'})\n\tok res.arr,['a']\n\n\tres = await OP.db.update('item01',arr: {$push: 'b'})\n\tok res.arr,['a','b']\n\n\tres = await OP.db.update('item01',arr: {$delete: 'a'})\n\tok res.arr,['b']"],"names":[],"mappings":";;;;;;;;;;;AAAA,MAAM,CAAC,KAAK,MAAM,UAAU;;AAE5B,KAAK,CAAC,IAAI,SAAG,EAAE,CAAC,MAAM,EAAA;qCAFtB;;;sBAGC,IAAI,CAAA;sBACJ,GAAG,CAAA;sBACH,IAAI,CAAA;sBACJ,GAAG,CAAA;sBACH,GAAG,CAAA;;EAPJ;cAAA;;;EAAA;kDAAA;;sCAGC,IAAI;qCACJ,GAAG;sCACH,IAAI;qCACJ,GAAG;qCACH,GAAG;;EAPJ;KAGC,IAAI;KAAJ,IAAI;KAAJ,MAAI,iDAAC,OAAO,EAAA,wBADP,IAAI;KAET,GAAG;KAAH,GAAG;KAAH,KAAG,iDAAC,OAAO,EAAA,uBAFN,IAAI;KAGT,IAAI;KAAJ,IAAI;KAAJ,MAAI,iDAAC,OAAO,EAAA,wBAHP,IAAI;KAIT,GAAG;KAAH,GAAG;KAAH,KAAG,iDAAC,KAAK,EAAA,uBAJJ,IAAI;KAKT,GAAG;KAAH,GAAG;KAAH,KAAG,kDAAC,KAAK,EAAA,wBALJ,IAAI;;;AAKA,CAAA;;MAEJ,KAAK,CAAC,UAAU,EAAE,IAAI,EAAE;CAC7B,MAAM,EAAE,CAAC,IAAI,EAAE,MAAM,CAAC;CACtB,EAAC;;AAEF,IAAI,CAAC,QAAQ,CAAC,cAAE,GAAA;;;KAEX,GAAG,GAAG;EACT,IAAI,EAAE,GAAG;EACT,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;EACX;;cAEK,EAAE,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC;CAAA,CAP7B;;AASJ,IAAI,CAAC,eAAe,CAAC,cAAE,GAAA;;;KAElB,GAAG,SAAS,EAAE,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC;EACrC,UAAU,EAAC,CAAC;EACZ,WAAW,EAAE,CAAC;EACd,CAAC;;CAEF,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAA;CACjB,OAAA,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAA;CAAA,CARf;;AAUJ,IAAI,CAAC,WAAW,CAAC,cAAE,GAAA;;KACd,GAAG,SAAS,EAAE,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC;EACrC,GAAG,EAAE,CAAC,KAAK,EAAE,CAAC,CAAC;EACf,CAAC;;CAEF,OAAA,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAA;CAAA,CALT;;AAOJ,IAAI,CAAC,OAAO,CAAC,cAAE,GAAA;;KACV,GAAG,SAAS,EAAE,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,EAAC,GAAG,EAAE,CAAC,KAAK,EAAE,GAAG,CAAC,EAAC;CACxD,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAA;;CAEhB,GAAG,SAAS,EAAE,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,EAAC,GAAG,EAAE,CAAC,KAAK,EAAE,GAAG,CAAC,EAAC;CACpD,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;;CAEpB,GAAG,SAAS,EAAE,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,EAAC,GAAG,EAAE,CAAC,OAAO,EAAE,GAAG,CAAC,EAAC;CACtD,OAAA,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAA;CAAA,CARb;AAQa;"}},"css":{"code":""},"warnings":[],"errors":[]}
{"js":{"code":"function defineName$__(cls,name){\n\tObject.defineProperty(cls,\"name\",{value:name,configurable:true});\n};;\nfunction inheritClass$__(cls){\n\tObject.getPrototypeOf(cls.prototype).constructor?.inherited?.(cls);\n};\nimport {accessor as imba_accessor} from 'imba';\nvar $1 = Symbol('name'), $2 = Symbol(), $3 = Symbol('seen'), $4 = Symbol(), $5 = Symbol('note'), $6 = Symbol(), $7 = Symbol('expanded'), $8 = Symbol(), $9 = Symbol(), $11, $12, $13, $14;\nconst $__init__$ = Symbol.for('#__init__'), $__patch__$ = Symbol.for('#__patch__'), $__initor__$ = Symbol.for('#__initor__'), $__inited__$ = Symbol.for('#__inited__'), $__hooks__$ = Symbol.for('#__hooks__');\n\n/*body*/\n\nimport setup from './setup';\n\nclass Item extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $10;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($10 = $$.name) !== undefined && this.ααname.$init($10,this,$1,'name',$$);\n\t\tfields && ($10 = $$.seen) !== undefined && this.ααseen.$init($10,this,$3,'seen',$$);\n\t\tfields && ($10 = $$.note) !== undefined && this.ααnote.$init($10,this,$5,'note',$$);\n\t\tfields && ($10 = $$.expanded) !== undefined && this.ααexpanded.$init($10,this,$7,'expanded',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$9 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααname.$init($$ ? $$.name : undefined,this,$1,'name',$$);\n\t\tfields && this.ααseen.$init($$ ? $$.seen : undefined,this,$3,'seen',$$);\n\t\tfields && this.ααnote.$init($$ ? $$.note : undefined,this,$5,'note',$$);\n\t\tfields && this.ααexpanded.$init($$ ? $$.expanded : undefined,this,$7,'expanded',$$);\n\t\t\n\t}\n\tset name(val){ this.ααname.$set(val,this,$1,'name') }\n\tget name(){ return this.ααname.$get(this,$1,'name') }\n\tget ααname(){ return this[$2] || imba_accessor(($11 = this.αstring(),$11),this,$1,'name',$2,Item.prototype) }\n\tset seen(val){ this.ααseen.$set(val,this,$3,'seen') }\n\tget seen(){ return this.ααseen.$get(this,$3,'seen') }\n\tget ααseen(){ return this[$4] || imba_accessor(($12 = this.αint(),($12.pov instanceof Function) ? $12.pov() : ($12.pov = true),$12),this,$3,'seen',$4,Item.prototype) }\n\tset note(val){ this.ααnote.$set(val,this,$5,'note') }\n\tget note(){ return this.ααnote.$get(this,$5,'note') }\n\tget ααnote(){ return this[$6] || imba_accessor(($13 = this.αtext(),($13.pov instanceof Function) ? $13.pov() : ($13.pov = true),$13),this,$5,'note',$6,Item.prototype) }\n\tset expanded(val){ this.ααexpanded.$set(val,this,$7,'expanded') }\n\tget expanded(){ return this.ααexpanded.$get(this,$7,'expanded') }\n\tget ααexpanded(){ return this[$8] || imba_accessor(($14 = this.αbool(),($14.pov instanceof Function) ? $14.pov() : ($14.pov = true),($14.local instanceof Function) ? $14.local() : ($14.local = true),$14),this,$7,'expanded',$8,Item.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $9;defineName$__(this,'Item');inheritClass$__(this);}\n};\n\nawait setup(__filename);\n\nconst user = await OPUser.create({name: \"Sindre\"});\ntest.todo(\"dont include changes set after .save\",function() {\n\t\n\treturn OP.withΞcontext(user,async function() {\n\t\t\n\t\tlet item = Item.build({name: \"1\",note: \"Private note\"});\n\t\tlet saving = item.save();\n\t\titem.name = \"2\";\n\t\tawait saving;\n\t\treturn ok((await OP.db.val`select name from _item where id = ${item.id}`),\"1\");\n\t});\n});\n\ntest.todo(\"multiple saves\",function() {\n\t\n\treturn OP.withΞcontext(user,async function() {\n\t\t\n\t\tlet item = Item.build({name: \"1\",note: \"Private note\"});\n\t\titem.save();\n\t\tawait globalThis.sleep(0);\n\t\titem.name = \"2\";\n\t\tawait item.save();\n\t\treturn ok((await OP.db.val`select name from _item where id = ${item.id}`),\"2\");\n\t});\n});\n","dependencies":[],"map":{"version":3,"file":"saving.test.js","sourceRoot":"","sources":["/Users/sindre/repos/scrimba/op/test/saving.test.imba"],"sourcesContent":["\nimport setup from './setup'\n\nclass Item < OP.Object\n\tname @string\n\tseen @int.pov\n\tnote @text.pov\n\texpanded @bool.pov.local\n\nawait setup(__filename)\n\nconst user = await OPUser.create(name: \"Sindre\")\ntest.todo \"dont include changes set after .save\" do\n\tOP.with-context(user) do\n\t\tlet item = Item.build(name: \"1\", note: \"Private note\")\n\t\tlet saving = item.save!\n\t\titem.name = \"2\"\n\t\tawait saving\n\t\tok (await OP.db.val`select name from _item where id = {item.id}`),\"1\"\n\ntest.todo \"multiple saves\" do\n\tOP.with-context(user) do\n\t\tlet item = Item.build(name: \"1\", note: \"Private note\")\n\t\titem.save!\n\t\tawait global.sleep(0)\n\t\titem.name = \"2\"\n\t\tawait item.save!\n\t\tok (await OP.db.val`select name from _item where id = {item.id}`),\"2\""],"names":[],"mappings":";;;;;;;;;;;;AACA,MAAM,CAAC,KAAK,MAAM,SAAS;;AAE3B,KAAK,CAAC,IAAI,SAAG,EAAE,CAAC,MAAM,EAAA;qCAHtB;;;sBAIC,IAAI,CAAA;sBACJ,IAAI,CAAA;sBACJ,IAAI,CAAA;sBACJ,QAAQ,CAAA;;EAPT;cAAA;;;EAAA;kDAAA;;sCAIC,IAAI;sCACJ,IAAI;sCACJ,IAAI;0CACJ,QAAQ;;EAPT;KAIC,IAAI;KAAJ,IAAI;KAAJ,MAAI,iDAAC,OAAO,EAAA,wBADP,IAAI;KAET,IAAI;KAAJ,IAAI;KAAJ,MAAI,iDAAC,IAAI,EAAA,MAAC,GAAG,4BAAH,GAAG,EAAA,QAAH,GAAG,gCAFR,IAAI;KAGT,IAAI;KAAJ,IAAI;KAAJ,MAAI,iDAAC,KAAK,EAAA,MAAC,GAAG,4BAAH,GAAG,EAAA,QAAH,GAAG,gCAHT,IAAI;KAIT,QAAQ;KAAR,QAAQ;KAAR,UAAQ,iDAAC,KAAK,EAAA,MAAC,GAAG,4BAAH,GAAG,EAAA,QAAH,GAAG,cAAC,KAAK,4BAAL,KAAK,EAAA,QAAL,KAAK,oCAJnB,IAAI;;;AAIe,CAAA;;MAEnB,KAAK,CAAC,UAAU,CAAC;;MAEjB,IAAI,SAAS,MAAM,CAAC,MAAM,EAAC,IAAI,EAAE,QAAQ,EAAC;AAChD,IAAI,CAAC,IAAI,CAAC,sCAAsC,CAAC,QAAE,GAAA;;CAClD,OAAA,EAAE,CAAC,YAAY,CAAC,IAAI,CAAE,cAAE,GAAA;;MACnB,IAAI,GAAG,IAAI,CAAC,KAAK,EAAC,IAAI,EAAE,GAAG,CAAE,IAAI,EAAE,cAAc,EAAC;MAClD,MAAM,GAAG,IAAI,CAAC,IAAI,EAAC;EACvB,IAAI,CAAC,IAAI,GAAG,GAAG;QACT,MAAM;EACZ,OAAA,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,GAAG,qCAAoC,IAAI,CAAC,EAAE,EAAE,EAAE,GAAG,CAAA;EAAA,CALjD;CAKiD,CAN9D;;AAQT,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,QAAE,GAAA;;CAC5B,OAAA,EAAE,CAAC,YAAY,CAAC,IAAI,CAAE,cAAE,GAAA;;MACnB,IAAI,GAAG,IAAI,CAAC,KAAK,EAAC,IAAI,EAAE,GAAG,CAAE,IAAI,EAAE,cAAc,EAAC;EACtD,IAAI,CAAC,IAAI,EAAC;QACJ,UAAM,CAAC,KAAK,CAAC,CAAC,CAAC;EACrB,IAAI,CAAC,IAAI,GAAG,GAAG;QACT,IAAI,CAAC,IAAI,EAAC;EAChB,OAAA,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,GAAG,qCAAoC,IAAI,CAAC,EAAE,EAAE,EAAE,GAAG,CAAA;EAAA,CANjD;CAMiD,CAP9D;AAO8D;"}},"css":{"code":""},"warnings":[],"errors":[]}
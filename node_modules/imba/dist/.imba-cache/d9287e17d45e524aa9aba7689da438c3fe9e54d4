{"js":{"code":"function defineName$__(cls,name){\n\tObject.defineProperty(cls,\"name\",{value:name,configurable:true});\n};;\nfunction inheritClass$__(cls){\n\tObject.getPrototypeOf(cls.prototype).constructor?.inherited?.(cls);\n};\nimport {accessor as imba_accessor} from 'imba';\nvar $1 = Symbol('name'), $2 = Symbol(), $3 = Symbol('desc'), $4 = Symbol(), $5 = Symbol('owner'), $6 = Symbol(), $7 = Symbol(), $8 = Symbol('id'), $9 = Symbol(), $10 = Symbol('owner'), $11 = Symbol(), $12 = Symbol(), $14, $15, $16, $18, $19;\nconst $__init__$ = Symbol.for('#__init__'), $__patch__$ = Symbol.for('#__patch__'), $__initor__$ = Symbol.for('#__initor__'), $__inited__$ = Symbol.for('#__inited__'), $__hooks__$ = Symbol.for('#__hooks__');\n\n/*body*/\nimport setup from './setup';\n\nclass Item extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $13;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($13 = $$.name) !== undefined && this.ααname.$init($13,this,$1,'name',$$);\n\t\tfields && ($13 = $$.desc) !== undefined && this.ααdesc.$init($13,this,$3,'desc',$$);\n\t\tfields && ($13 = $$.owner) !== undefined && this.ααowner.$init($13,this,$5,'owner',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$7 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααname.$init($$ ? $$.name : undefined,this,$1,'name',$$);\n\t\tfields && this.ααdesc.$init($$ ? $$.desc : undefined,this,$3,'desc',$$);\n\t\tfields && this.ααowner.$init($$ ? $$.owner : undefined,this,$5,'owner',$$);\n\t\t\n\t}\n\tset name(val){ this.ααname.$set(val,this,$1,'name') }\n\tget name(){ return this.ααname.$get(this,$1,'name') }\n\tget ααname(){ return this[$2] || imba_accessor(($14 = this.αstring(),$14),this,$1,'name',$2,Item.prototype) }\n\tset desc(val){ this.ααdesc.$set(val,this,$3,'desc') }\n\tget desc(){ return this.ααdesc.$get(this,$3,'desc') }\n\tget ααdesc(){ return this[$4] || imba_accessor(($15 = this.αstring(),($15.r instanceof Function) ? $15.r(OP.OWNER) : ($15.r = OP.OWNER),$15),this,$3,'desc',$4,Item.prototype) }\n\tset owner(val){ this.ααowner.$set(val,this,$5,'owner') }\n\tget owner(){ return this.ααowner.$get(this,$5,'owner') }\n\tget ααowner(){ return this[$6] || imba_accessor(($16 = this.αref(User),($16.as instanceof Function) ? $16.as(OP.OWNER) : ($16.as = OP.OWNER),$16),this,$5,'owner',$6,Item.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $7;defineName$__(this,'Item');inheritClass$__(this);}\n}; globalThis.Item = Item;\n\nclass Private extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $17;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($17 = $$.id) !== undefined && this.ααid.$init($17,this,$8,'id',$$);\n\t\tfields && ($17 = $$.owner) !== undefined && this.ααowner.$init($17,this,$10,'owner',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$12 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααid.$init($$ ? $$.id : undefined,this,$8,'id',$$);\n\t\tfields && this.ααowner.$init($$ ? $$.owner : undefined,this,$10,'owner',$$);\n\t\t\n\t}\n\tset id(val){ this.ααid.$set(val,this,$8,'id') }\n\tget id(){ return this.ααid.$get(this,$8,'id') }\n\tget ααid(){ return this[$9] || imba_accessor(($18 = this.αkey(),($18.r instanceof Function) ? $18.r(OP.OWNER) : ($18.r = OP.OWNER),$18),this,$8,'id',$9,Private.prototype) }\n\tset owner(val){ this.ααowner.$set(val,this,$10,'owner') }\n\tget owner(){ return this.ααowner.$get(this,$10,'owner') }\n\tget ααowner(){ return this[$11] || imba_accessor(($19 = this.αref(User),($19.as instanceof Function) ? $19.as(OP.OWNER) : ($19.as = OP.OWNER),$19),this,$10,'owner',$11,Private.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $12;defineName$__(this,'Private');inheritClass$__(this);}\n}; globalThis.Private = Private;\n\nclass User extends OP.User {\nstatic {\n\tdefineName$__(this,'User');inheritClass$__(this);}}; globalThis.User = User;\n\nawait setup(__filename,{\n\tdata: [\n\t\t{id: 'U01'},\n\t\t{id: 'U02'},\n\t\t{id: 'item01',name: 'name1',desc: 'desc1',owner: 'U01'},\n\t\t{id: 'item02',name: 'name2',desc: 'desc2',owner: 'U02'},\n\t\t{id: 'private01',owner: 'U01'},\n\t\t{id: 'private02',owner: 'U02'}\n\t],\n\tpreload: true\n});\n\nlet item1 = OP.get('item01');\nlet item2 = OP.get('item02');\nlet private1 = OP.get('private01');\nlet private2 = OP.get('private02');\nlet user1 = OP.get('U01');\nlet user2 = OP.get('U02');\n\nlet item1user1 = item1.dehydrateΞfor(user1);\nlet item1user2 = item1.dehydrateΞfor(user2);\nlet item2user1 = item2.dehydrateΞfor(user1);\nlet item2user2 = item2.dehydrateΞfor(user2);\nlet private1user1 = private1.dehydrateΞfor(user1);\nlet private1user2 = private1.dehydrateΞfor(user2);\nlet private2user1 = private2.dehydrateΞfor(user1);\nlet private2user2 = private2.dehydrateΞfor(user2);\n\ntest(\"caching\",function() {\n\t\n\tok(item1.name,'name1');\n\tok(item1.desc,'desc1');\n\tok(item2.name,'name2');\n\tok(item2.desc,'desc2');\n\t\n\tok(item1user1,item1.dehydrateΞfor(user1));\n\tok(item1user2,item1.dehydrateΞfor(user2));\n\tok(item2user1,item2.dehydrateΞfor(user1));\n\treturn ok(item2user2,item2.dehydrateΞfor(user2));\n});\n\ntest(\"permissions\",function() {\n\t\n\tok(item1user1.name,'name1');\n\tok(item1user1.desc,'desc1');\n\t\n\tok(item1user2.name,'name1');\n\tok(item1user2.desc,undefined);\n\t\n\tok(item2user1.name,'name2');\n\tok(item2user1.desc,undefined);\n\t\n\tok(item2user2.name,'name2');\n\treturn ok(item2user2.desc,'desc2');\n});\n\ntest(\"cache invalidation\",function() {\n\t\n\titem1.owner = user2;\n\titem2.owner = user1;\n\t\n\tnok(item1user1,item1.dehydrateΞfor(user1));\n\tnok(item1user2,item1.dehydrateΞfor(user2));\n\tnok(item2user1,item2.dehydrateΞfor(user1));\n\tnok(item2user2,item2.dehydrateΞfor(user2));\n\t\n\titem1user1 = item1.dehydrateΞfor(user1);\n\titem1user2 = item1.dehydrateΞfor(user2);\n\titem2user1 = item2.dehydrateΞfor(user1);\n\titem2user2 = item2.dehydrateΞfor(user2);\n\t\n\titem1.packΞfor(user1);\n\titem1.packΞfor(user1);\n\titem2.packΞfor(user1);\n\treturn item2.packΞfor(user1);\n});\n\ntest(\"private\",ok(private1user1.id,'private01'),\nok(private1user2,undefined),\nok(private2user1,undefined),\nok(private2user2.id,'private02'));\n","dependencies":[],"map":{"version":3,"file":"dehydrate.test.js","sourceRoot":"","sources":["/Users/sindre/repos/scrimba/op/test/dehydrate.test.imba"],"sourcesContent":["import setup from './setup'\n\nglobal class Item < OP.Object\n\tname @string\n\tdesc @string.r(OP.OWNER)\n\towner @ref(User).as(OP.OWNER)\n\nglobal class Private < OP.Object\n\tid @key.r(OP.OWNER)\n\towner @ref(User).as(OP.OWNER)\n\nglobal class User < OP.User\n\nawait setup(__filename, {\n\tdata: [\n\t\t{ id: 'U01' }\n\t\t{ id: 'U02' }\n\t\t{ id: 'item01', name: 'name1', desc: 'desc1', owner: 'U01' }\n\t\t{ id: 'item02', name: 'name2', desc: 'desc2', owner: 'U02' }\n\t\t{ id: 'private01', owner: 'U01' }\n\t\t{ id: 'private02', owner: 'U02' }\n\t]\n\tpreload: yes\n})\n\nlet item1 = OP.get 'item01'\nlet item2 = OP.get 'item02'\nlet private1 = OP.get 'private01'\nlet private2 = OP.get 'private02'\nlet user1 = OP.get 'U01'\nlet user2 = OP.get 'U02'\n\nlet item1user1 = item1.dehydrate-for(user1)\nlet item1user2 = item1.dehydrate-for(user2)\nlet item2user1 = item2.dehydrate-for(user1)\nlet item2user2 = item2.dehydrate-for(user2)\nlet private1user1 = private1.dehydrate-for(user1)\nlet private1user2 = private1.dehydrate-for(user2)\nlet private2user1 = private2.dehydrate-for(user1)\nlet private2user2 = private2.dehydrate-for(user2)\n\ntest \"caching\" do\n\tok item1.name, 'name1'\n\tok item1.desc, 'desc1'\n\tok item2.name, 'name2'\n\tok item2.desc, 'desc2'\n\n\tok item1user1, item1.dehydrate-for(user1)\n\tok item1user2, item1.dehydrate-for(user2)\n\tok item2user1, item2.dehydrate-for(user1)\n\tok item2user2, item2.dehydrate-for(user2)\n\ntest \"permissions\" do\n\tok item1user1.name, 'name1'\n\tok item1user1.desc, 'desc1'\n\n\tok item1user2.name, 'name1'\n\tok item1user2.desc, undefined\n\n\tok item2user1.name, 'name2'\n\tok item2user1.desc, undefined\n\n\tok item2user2.name, 'name2'\n\tok item2user2.desc, 'desc2'\n\ntest \"cache invalidation\" do\n\titem1.owner = user2\n\titem2.owner = user1\n\n\tnok item1user1, item1.dehydrate-for(user1)\n\tnok item1user2, item1.dehydrate-for(user2)\n\tnok item2user1, item2.dehydrate-for(user1)\n\tnok item2user2, item2.dehydrate-for(user2)\n\n\titem1user1 = item1.dehydrate-for(user1)\n\titem1user2 = item1.dehydrate-for(user2)\n\titem2user1 = item2.dehydrate-for(user1)\n\titem2user2 = item2.dehydrate-for(user2)\n\n\titem1.pack-for(user1)\n\titem1.pack-for(user1)\n\titem2.pack-for(user1)\n\titem2.pack-for(user1)\n\ntest \"private\"\n\tok private1user1.id, 'private01'\n\tok private1user2, undefined\n\tok private2user1, undefined\n\tok private2user2.id, 'private02'\n"],"names":[],"mappings":"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"}},"css":{"code":""},"warnings":[],"errors":[]}
{"js":{"code":"function defineName$__(cls,name){\n\tObject.defineProperty(cls,\"name\",{value:name,configurable:true});\n};;\nfunction inheritClass$__(cls){\n\tObject.getPrototypeOf(cls.prototype).constructor?.inherited?.(cls);\n};\nimport {accessor as imba_accessor} from 'imba';\nvar $1 = Symbol('name'), $2 = Symbol(), $3 = Symbol('seen'), $4 = Symbol(), $5 = Symbol('note'), $6 = Symbol(), $7 = Symbol('expanded'), $8 = Symbol(), $9 = Symbol(), $11, $12, $13, $14;\nconst $__init__$ = Symbol.for('#__init__'), $__patch__$ = Symbol.for('#__patch__'), $__initor__$ = Symbol.for('#__initor__'), $__inited__$ = Symbol.for('#__inited__'), $__hooks__$ = Symbol.for('#__hooks__');\n\n/*body*/\n\nimport setup from './setup';\n\nclass Item extends OP.Object {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $10;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($10 = $$.name) !== undefined && this.ααname.$init($10,this,$1,'name',$$);\n\t\tfields && ($10 = $$.seen) !== undefined && this.ααseen.$init($10,this,$3,'seen',$$);\n\t\tfields && ($10 = $$.note) !== undefined && this.ααnote.$init($10,this,$5,'note',$$);\n\t\tfields && ($10 = $$.expanded) !== undefined && this.ααexpanded.$init($10,this,$7,'expanded',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$9 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααname.$init($$ ? $$.name : undefined,this,$1,'name',$$);\n\t\tfields && this.ααseen.$init($$ ? $$.seen : undefined,this,$3,'seen',$$);\n\t\tfields && this.ααnote.$init($$ ? $$.note : undefined,this,$5,'note',$$);\n\t\tfields && this.ααexpanded.$init($$ ? $$.expanded : undefined,this,$7,'expanded',$$);\n\t\t\n\t}\n\tset name(val){ this.ααname.$set(val,this,$1,'name') }\n\tget name(){ return this.ααname.$get(this,$1,'name') }\n\tget ααname(){ return this[$2] || imba_accessor(($11 = this.αstring(),$11),this,$1,'name',$2,Item.prototype) }\n\tset seen(val){ this.ααseen.$set(val,this,$3,'seen') }\n\tget seen(){ return this.ααseen.$get(this,$3,'seen') }\n\tget ααseen(){ return this[$4] || imba_accessor(($12 = this.αint(),($12.pov instanceof Function) ? $12.pov() : ($12.pov = true),$12),this,$3,'seen',$4,Item.prototype) }\n\tset note(val){ this.ααnote.$set(val,this,$5,'note') }\n\tget note(){ return this.ααnote.$get(this,$5,'note') }\n\tget ααnote(){ return this[$6] || imba_accessor(($13 = this.αtext(),($13.pov instanceof Function) ? $13.pov() : ($13.pov = true),$13),this,$5,'note',$6,Item.prototype) }\n\tset expanded(val){ this.ααexpanded.$set(val,this,$7,'expanded') }\n\tget expanded(){ return this.ααexpanded.$get(this,$7,'expanded') }\n\tget ααexpanded(){ return this[$8] || imba_accessor(($14 = this.αbool(),($14.pov instanceof Function) ? $14.pov() : ($14.pov = true),($14.local instanceof Function) ? $14.local() : ($14.local = true),$14),this,$7,'expanded',$8,Item.prototype) }\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $9;defineName$__(this,'Item');inheritClass$__(this);}\n};\n\nawait setup(__filename,{e2e: true,data: {\n\titem: function() { return Item.create({name: \"Hey\"}); },\n\tuser: function() { return OPUser.create({name: \"Sindre\"}); }\n}});\n\n// const item = await Item.create(name: \"Hey\")\n// const user = await OPUser.create(name: \"Sindre\")\n\ntest(\"save\",function({user: user}) {\n\t\n\treturn OP.withΞcontext(user,async function() {\n\t\t\n\t\tlet item = await Item.create({name: \"Hey\"});\n\t\tok(!(item.unsavedΦ));\n\t\tok(item.savedΦ);\n\t\titem.note = \"Private\";\n\t\tok(item.unsavedΦ);\n\t\tok(OP.user,user);\n\t\tok(OP.agent,user);\n\t\tawait item.save();\n\t\treturn ok(item.pov.$cloud.note,\"Private\");\n\t});\n});\n\ntest(\"set pov properties in build\",function({user: user}) {\n\t\n\treturn OP.withΞcontext(user,async function() {\n\t\t\n\t\tlet item = await Item.create({name: \"Hey\",note: \"Private note\"});\n\t\tok(item.note,\"Private note\");\n\t\tconsole.log(\"%s %s %O\",'\u001b[90m::\u001b[0m','\u001b[44m\u001b[97mitem.pov.$cloud\u001b[0m',item.pov.$cloud);\n\t\treturn ok(item.pov.$cloud.note,\"Private note\");\n\t});\n});\n\ntest.skip(\"set via Mutation\",async function() {\n\t\n\tok(item._rev,8);\n\tlet id = (\"\" + (item.id) + `.` + (user.id));\n\tlet mut = OPSET.for(id,'seen',OP.now);\n\t// should it commit or persist?\n\tawait mut.commit();\n\t\n\tok(mut.object,OP.get(id));\n\tok(mut.object.rev >= 4);\n\treturn ok(mut.object.$plain.hasOwnProperty('_rev'));\n});\n","dependencies":[],"map":{"version":3,"file":"pov.test.js","sourceRoot":"","sources":["/Users/sindre/repos/scrimba/op/test/pov.test.imba"],"sourcesContent":["\nimport setup from './setup'\n\nclass Item < OP.Object\n\tname @string\n\tseen @int.pov\n\tnote @text.pov\n\texpanded @bool.pov.local\n\nawait setup __filename, e2e:yes, data: {\n\titem: do Item.create(name: \"Hey\")\n\tuser: do OPUser.create(name: \"Sindre\")\n}\n\n# const item = await Item.create(name: \"Hey\")\n# const user = await OPUser.create(name: \"Sindre\")\n\ntest \"save\" do({user})\n\tOP.with-context(user) do\n\t\tlet item = await Item.create(name: \"Hey\")\n\t\tok !item.unsaved?\n\t\tok item.saved?\n\t\titem.note = \"Private\"\n\t\tok item.unsaved?\n\t\tok OP.user,user\n\t\tok OP.agent,user\n\t\tawait item.save!\n\t\tok item.pov.$cloud.note,\"Private\"\n\ntest \"set pov properties in build\" do({user})\n\tOP.with-context(user) do\n\t\tlet item = await Item.create(name: \"Hey\", note: \"Private note\")\n\t\tok item.note,\"Private note\"\n\t\tL item.pov.$cloud\n\t\tok item.pov.$cloud.note,\"Private note\"\n\ntest.skip \"set via Mutation\" do\n\tok item._rev,8\n\tlet id = `{item.id}.{user.id}`\n\tlet mut = OPSET.for(id,'seen',OP.now)\n\t# should it commit or persist?\n\tawait mut.commit!\n\n\tok mut.object,OP.get(id)\n\tok mut.object.rev >= 4\n\tok mut.object.$plain.hasOwnProperty('_rev')"],"names":[],"mappings":"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"}},"css":{"code":""},"warnings":[],"errors":[]}
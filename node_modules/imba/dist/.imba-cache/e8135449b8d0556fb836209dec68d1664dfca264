{"js":{"code":"function defineName$__(cls,name){\n\tObject.defineProperty(cls,\"name\",{value:name,configurable:true});\n};;\nfunction inheritClass$__(cls){\n\tObject.getPrototypeOf(cls.prototype).constructor?.inherited?.(cls);\n};\nimport {accessor as imba_accessor} from 'imba';\nvar $1 = Symbol('id'), $2 = Symbol(), $3 = Symbol('user'), $4 = Symbol(), $5 = Symbol('server'), $6 = Symbol(), $7 = Symbol('ua'), $8 = Symbol(), $9 = Symbol('ip'), $10 = Symbol(), $11 = Symbol('country'), $12 = Symbol(), $13 = Symbol(), $15, $16, $17, $18, $19, $20;\nconst $__init__$ = Symbol.for('#__init__'), $__patch__$ = Symbol.for('#__patch__'), $__initor__$ = Symbol.for('#__initor__'), $__inited__$ = Symbol.for('#__inited__'), $__hooks__$ = Symbol.for('#__hooks__');\n\n/*body*/\nexport class OPSession extends OPObject {\n\t[$__patch__$]($$ = {},fields = true){\n\t\tvar $14;\n\t\tsuper[$__patch__$] && super[$__patch__$]($$,fields);\n\t\tfields && ($14 = $$.id) !== undefined && this.ααid.$init($14,this,$1,'id',$$);\n\t\tfields && ($14 = $$.user) !== undefined && this.ααuser.$init($14,this,$3,'user',$$);\n\t\tfields && ($14 = $$.server) !== undefined && this.ααserver.$init($14,this,$5,'server',$$);\n\t\tfields && ($14 = $$.ua) !== undefined && this.ααua.$init($14,this,$7,'ua',$$);\n\t\tfields && ($14 = $$.ip) !== undefined && this.ααip.$init($14,this,$9,'ip',$$);\n\t\tfields && ($14 = $$.country) !== undefined && this.ααcountry.$init($14,this,$11,'country',$$);\n\t\t\n\t}\n\tconstructor(){\n\t\tsuper(...arguments);\n\t\tsuper[$__init__$] || this[$__init__$]();this[$__initor__$]===$13 && (this[$__hooks__$]&&this[$__hooks__$].inited(this),this[$__inited__$] && this[$__inited__$]());\n\t}\n\t[$__init__$]($$ = null,deep = true,fields = true){\n\t\tdeep && super[$__init__$] && super[$__init__$](...arguments);\n\t\tfields && this.ααid.$init($$ ? $$.id : undefined,this,$1,'id',$$);\n\t\tfields && this.ααuser.$init($$ ? $$.user : undefined,this,$3,'user',$$);\n\t\tfields && this.ααserver.$init($$ ? $$.server : undefined,this,$5,'server',$$);\n\t\tfields && this.ααua.$init($$ ? $$.ua : undefined,this,$7,'ua',$$);\n\t\tfields && this.ααip.$init($$ ? $$.ip : undefined,this,$9,'ip',$$);\n\t\tfields && this.ααcountry.$init($$ ? $$.country : undefined,this,$11,'country',$$);\n\t\t\n\t}\n\tset id(val){ this.ααid.$set(val,this,$1,'id') }\n\tget id(){ return this.ααid.$get(this,$1,'id') }\n\tget ααid(){ return this[$2] || imba_accessor(($15 = this.αkey(),($15.system instanceof Function) ? $15.system() : ($15.system = true),$15.size = 12,($15.c instanceof Function) ? $15.c(OP.SRV) : ($15.c = OP.SRV),$15),this,$1,'id',$2,OPSession.prototype) }\n\tset user(val){ this.ααuser.$set(val,this,$3,'user') }\n\tget user(){ return this.ααuser.$get(this,$3,'user') }\n\tget ααuser(){ return this[$4] || imba_accessor(($16 = this.αref(OP.User),($16.foreign instanceof Function) ? $16.foreign() : ($16.foreign = true),($16.observable instanceof Function) ? $16.observable() : ($16.observable = true),$16),this,$3,'user',$4,OPSession.prototype) }\n\tset server(val){ this.ααserver.$set(val,this,$5,'server') }\n\tget server(){ return this.ααserver.$get(this,$5,'server') }\n\tget ααserver(){ return this[$6] || imba_accessor(($17 = this.αref(OP.Server),($17.observable instanceof Function) ? $17.observable() : ($17.observable = true),$17),this,$5,'server',$6,OPSession.prototype) }\n\tset ua(val){ this.ααua.$set(val,this,$7,'ua') }\n\tget ua(){ return this.ααua.$get(this,$7,'ua') }\n\tget ααua(){ return this[$8] || imba_accessor(($18 = this.αstring(),($18.audited instanceof Function) ? $18.audited() : ($18.audited = true),($18.hidden instanceof Function) ? $18.hidden() : ($18.hidden = true),$18),this,$7,'ua',$8,OPSession.prototype) }\n\tset ip(val){ this.ααip.$set(val,this,$9,'ip') }\n\tget ip(){ return this.ααip.$get(this,$9,'ip') }\n\tget ααip(){ return this[$10] || imba_accessor(($19 = this.αstring(),($19.audited instanceof Function) ? $19.audited() : ($19.audited = true),($19.hidden instanceof Function) ? $19.hidden() : ($19.hidden = true),$19),this,$9,'ip',$10,OPSession.prototype) }\n\tset country(val){ this.ααcountry.$set(val,this,$11,'country') }\n\tget country(){ return this.ααcountry.$get(this,$11,'country') }\n\tget ααcountry(){ return this[$12] || imba_accessor(($20 = this.αstring(),$20),this,$11,'country',$12,OPSession.prototype) }// Could later be OP.Country type - built in. Makes sense to have these.\n\t\n\trolesΞfor(pov){\n\t\t\n\t\treturn super.rolesΞfor(...arguments) | ((pov === this || (pov && pov == this.user)) ? OP.OWNER : 0);\n\t}\n\t\n\t/**\n\t@param {(User)} user\n\t*/\n\tasync login(user){\n\t\t\n\t\tif (!(true)) {};\n\t\tawait this.update({user: user});\n\t\tif (OPSignedIn.implementedΦ) {\n\t\t\t\n\t\t\tawait OPSignedIn.create({session: this,user: user});\n\t\t};\n\t\treturn this;\n\t}\n\t\n\t/**\n\t@param {(User)} user\n\t*/\n\tasync logout(user = null){\n\t\t\n\t\tif (!(true)) {};\n\t\tawait this.$update({user: null});\n\t\treturn this;\n\t}\n\t\n\tget agent(){\n\t\t\n\t\treturn this.user || this;\n\t}\n\tstatic {\n\t\tthis.prototype[$__initor__$] = $13;defineName$__(this,'OPSession');this.alias = 'S';\n\t\tinheritClass$__(this);}\n}; globalThis.OPSession = OPSession;\n","dependencies":[],"map":{"version":3,"file":"session.js","sourceRoot":"","sources":["/Users/sindre/repos/scrimba/op/src/types/session.imba"],"sourcesContent":["export global class OPSession < OPObject\n\tstatic alias = 'S'\n\n\tid @key.system.size[12].c(OP.SRV)\n\tuser @ref(OP.User).foreign.observable\n\tserver @ref(OP.Server).observable\n\tua @string.audited.hidden\n\tip @string.audited.hidden\n\tcountry @string # Could later be OP.Country type - built in. Makes sense to have these.\n\n\tdef roles-for pov\n\t\tsuper | (pov === self or (pov and pov == user) ? OP.OWNER : 0)\n\n\tdef login user\\(User)\n\t\treturn unless $node$\n\t\tawait update { user }\n\t\tif OPSignedIn.implemented?\n\t\t\tawait OPSignedIn.create(session: self, user: user)\n\t\treturn self\n\n\tdef logout user\\(User) = null\n\t\treturn unless $node$\n\t\tawait $update(user: null)\n\t\tself\n\n\tget agent\n\t\tuser or self\n"],"names":[],"mappings":";;;;;;;;;;;AAAA,MAAM,CAAQ,KAAK,CAAC,SAAS,SAAG,QAAQ,EAAA;qCAAxC;;;sBAGC,EAAE,CAAA;sBACF,IAAI,CAAA;sBACJ,MAAM,CAAA;sBACN,EAAE,CAAA;sBACF,EAAE,CAAA;sBACF,OAAO,CAAA;;EARR;cAAA;;;EAAA;kDAAA;;oCAGC,EAAE;sCACF,IAAI;wCACJ,MAAM;oCACN,EAAE;oCACF,EAAE;yCACF,OAAO;;EARR;KAGC,EAAE;KAAF,EAAE;KAAF,IAAE,iDAAC,IAAI,EAAA,MAAC,MAAM,4BAAN,MAAM,EAAA,QAAN,MAAM,aAAC,IAAI,GAAC,EAAE,MAAE,CAAC,4BAAD,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,QAAT,CAAC,GAAC,EAAE,CAAC,GAAG,uBAHb,SAAS;KAI5B,IAAI;KAAJ,IAAI;KAAJ,MAAI,iDAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,MAAC,OAAO,4BAAP,OAAO,EAAA,QAAP,OAAO,cAAC,UAAU,4BAAV,UAAU,EAAA,QAAV,UAAU,gCAJlB,SAAS;KAK5B,MAAM;KAAN,MAAM;KAAN,QAAM,iDAAC,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,MAAC,UAAU,4BAAV,UAAU,EAAA,QAAV,UAAU,kCALd,SAAS;KAM5B,EAAE;KAAF,EAAE;KAAF,IAAE,iDAAC,OAAO,EAAA,MAAC,OAAO,4BAAP,OAAO,EAAA,QAAP,OAAO,cAAC,MAAM,4BAAN,MAAM,EAAA,QAAN,MAAM,8BANN,SAAS;KAO5B,EAAE;KAAF,EAAE;KAAF,IAAE,kDAAC,OAAO,EAAA,MAAC,OAAO,4BAAP,OAAO,EAAA,QAAP,OAAO,cAAC,MAAM,4BAAN,MAAM,EAAA,QAAN,MAAM,+BAPN,SAAS;KAQ5B,OAAO;KAAP,OAAO;KAAP,SAAO,kDAAC,OAAO,EAAA,6BARI,SAAS;;CAUxB,SAAS,CAAC,GAAG,CAAA;;EAChB,OAAA,MADG,SAAS,cACP,CAAC,CAAC,EAAE,CAAA,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,EAAE,GAAG,CAAC,EAAG,CAAC,GAAG,CAAC,EAAE,CAAC,KAAA,IAAI,KAAI,EAAE,CAAC,KAAK,GAAG,CAAC;EAAC;;;SAEhD,MAAM;;OAAjB,KAAK,CAAC,IAAI,CAAO;;EACb,EAAM,IAAC,IAAM;QACd,KAAA,MAAM,CAAC,CAAE,IAAI,OAAE,CAAA;EACrB,EAAE,EAAC,UAAU,CAAC,YAAY,EAAA;;SACnB,UAAU,CAAC,MAAM,EAAC,OAAO,EAAE,IAAI,CAAE,IAAI,EAAE,IAAI,EAAC;GAAA;EACnD,MAAM,CAAC,IAAI;EAAA;;;SAEI,MAAM;;OAAlB,MAAM,CAAC,IAAI,GAAU,IAAI,CAAA;;EACrB,EAAM,IAAC,IAAM;QACd,KAAA,OAAO,EAAC,IAAI,EAAE,IAAI,EAAC;EACzB,OAAA,IAAI;EAAA;;CAEL,GAAG,CAAC,KAAK,EAAA;;EACR,OAAA,KAAA,IAAI,CAAC,EAAE,CAAC,IAAI;EAAA;;0EAzBN,KAAK,GAAG,GAAG;;AAyBL,cA1BM,SAAS,GAAT,SAAS;AA2B7B;"}},"css":{"code":""},"warnings":[],"errors":[]}
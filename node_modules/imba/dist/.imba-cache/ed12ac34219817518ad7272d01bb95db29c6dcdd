{"js":{"code":"\n/*body*/\n// TODO Op\n\nimport 'imba/std';\nimport os from 'os';\nimport np from 'path';\nimport nfs from 'fs';\nimport cp from 'child_process';\n\ndescribe(\"op-create\",function() {\n\t\n\t\n\tlet dir = __filename.replace('test/','test/.fs/').replace('.test.imba','');\n\ttry {\n\t\tnfs.rmSync(dir,{recursive: true});\n\t} catch (e) { };\n\tnfs.mkdirSync(dir,{recursive: true});\n\tlet cwd = dir;\n\t\n\ttest(\"create new server project in temp dir\",function() {\n\t\t\n\t\t\n\t\tlet res = cp.spawnSync(\"op-create\",{cwd: np.join(cwd,\"\")});\n\t\tif (res.status !== 0) {\n\t\t\t\n\t\t\tconsole.log(res.stdout?.toString?.());\n\t\t\tconsole.log((\"Error running op-create in \" + cwd),res.stderr?.toString?.());\n\t\t\tthrow {name: 'Error creating server project',message: res.stderr?.toString?.()};\n\t\t};\n\t\t\n\t\tlet projectΞname = res.stdout.toString().trim();\n\t\tok(projectΞname.length > 0);\n\t\treturn cwd = np.join(cwd,projectΞname);\n\t});\n\t\n\ttest(\"run server project\",function() {\n\t\t\n\t\tlet res = cp.spawnSync(\"npm\",[\"run\",\"dev\"],{cwd: cwd});\n\t\tif (res.status !== 0) {\n\t\t\t\n\t\t\tconsole.log(res.stdout?.toString?.());\n\t\t\tconsole.log((\"Error running nr dev in \" + cwd),res.stderr?.toString?.());\n\t\t\tthrow {name: 'Error running server project',message: res.stderr?.toString?.()};\n\t\t};\n\t});\n\t\n\ttest(\"create new fullstack project in temp dir\",function() {\n\t\t\n\t\tcwd = dir;\n\t\tlet res = cp.spawnSync(\"op-create\",[\"-f\"],{cwd: cwd});\n\t\tif (res.status !== 0) {\n\t\t\t\n\t\t\tconsole.log(res.stdout?.toString?.());\n\t\t\tconsole.log((\"Error running op-create -f in \" + cwd),res.stderr?.toString?.());\n\t\t\tthrow {name: 'Error creating fullstack project',message: res.stderr?.toString?.()};\n\t\t};\n\t\t\n\t\tlet projectΞname = res.stdout.toString().trim();\n\t\tok(projectΞname.length > 0);\n\t\treturn cwd = np.join(cwd,projectΞname);\n\t});\n\t\n\treturn test.skip(\"run fullstack project\",async function() {\n\t\t\n\t\t// TODO should use playwright to detect client side errors\n\t\t\n\t\tlet child = cp.spawn(\"npm\",[\"run\",\"dev\"],{cwd: cwd});\n\t\tlet res = await new Promise(async function(resolve) {\n\t\t\t\n\t\t\tchild.on('exit',function(code,signal) {\n\t\t\t\t\n\t\t\t\tif (signal === 'SIGINT') {\n\t\t\t\t\t\n\t\t\t\t\treturn resolve(true);\n\t\t\t\t} else {\n\t\t\t\t\t\n\t\t\t\t\treturn resolve((\"\" + code + \", \" + signal));\n\t\t\t\t};\n\t\t\t});\n\t\t\tchild.stderr.on('data',function(data) {\n\t\t\t\t\n\t\t\t\treturn resolve(data.toString());\n\t\t\t});\n\t\t\tawait sleep((4 * 1000));\n\t\t\treturn child.kill('SIGINT');\n\t\t});\n\t\t\n\t\tif (!(res === true)) {\n\t\t\t\n\t\t\tthrow {name: 'Error running fullstack project',message: res};\n\t\t};\n\t});\n});\n","dependencies":[],"map":{"version":3,"file":"op-create.node.test.js","sourceRoot":"","sources":["/Users/sindre/repos/scrimba/op/test/bin/op-create.node.test.imba"],"sourcesContent":["# TODO Op\n\nimport 'imba/std'\nimport os from 'os'\nimport np from 'path'\nimport nfs from 'fs'\nimport cp from 'child_process'\n\ndescribe \"op-create\" do\n\n\tlet dir = __filename.replace('test/','test/.fs/').replace('.test.imba','')\n\ttry nfs.rmSync(dir, recursive: yes)\n\tnfs.mkdirSync(dir, recursive: yes)\n\tlet cwd = dir\n\n\ttest \"create new server project in temp dir\" do\n\n\t\tlet res = cp.spawnSync \"op-create\", { cwd: np.join(cwd, \"\") }\n\t\tif res.status isnt 0\n\t\t\tconsole.log res.stdout..toString!\n\t\t\tconsole.log \"Error running op-create in {cwd}\", res.stderr..toString!\n\t\t\tthrow { name: 'Error creating server project', message: res.stderr..toString! }\n\n\t\tlet project-name = res.stdout.toString!.trim!\n\t\tok project-name.length > 0\n\t\tcwd = np.join cwd, project-name\n\n\ttest \"run server project\" do\n\t\tlet res = cp.spawnSync \"npm\", [\"run\", \"dev\"], { cwd }\n\t\tif res.status isnt 0\n\t\t\tconsole.log res.stdout..toString!\n\t\t\tconsole.log \"Error running nr dev in {cwd}\", res.stderr..toString!\n\t\t\tthrow { name: 'Error running server project', message: res.stderr..toString! }\n\n\ttest \"create new fullstack project in temp dir\" do\n\t\tcwd = dir\n\t\tlet res = cp.spawnSync \"op-create\", [\"-f\"], { cwd }\n\t\tif res.status isnt 0\n\t\t\tconsole.log res.stdout..toString!\n\t\t\tconsole.log \"Error running op-create -f in {cwd}\", res.stderr..toString!\n\t\t\tthrow { name: 'Error creating fullstack project', message: res.stderr..toString! }\n\n\t\tlet project-name = res.stdout.toString!.trim!\n\t\tok project-name.length > 0\n\t\tcwd = np.join cwd, project-name\n\n\ttest.skip \"run fullstack project\" do\n\t\t# TODO should use playwright to detect client side errors\n\n\t\tlet child = cp.spawn \"npm\", [\"run\", \"dev\"], { cwd }\n\t\tlet res = await new Promise do(resolve)\n\t\t\tchild.on 'exit' do(code, signal)\n\t\t\t\tif signal is 'SIGINT'\n\t\t\t\t\tresolve yes\n\t\t\t\telse\n\t\t\t\t\tresolve \"{code}, {signal}\"\n\t\t\tchild.stderr.on 'data', do(data)\n\t\t\t\tresolve data.toString!\n\t\t\tawait sleep 4s\n\t\t\tchild.kill 'SIGINT'\n\n\t\tunless res is yes\n\t\t\tthrow { name: 'Error running fullstack project', message: res }\n"],"names":[],"mappings":"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"}},"css":{"code":""},"warnings":[],"errors":[]}